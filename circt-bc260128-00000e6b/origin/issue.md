<!--
  CIRCT Bug Report
  Generated by circt-bug-reporter skill
-->

<!-- Title: [Moore] Assertion failure in MooreToCore when lowering string type port -->

## Description

CIRCT's Moore dialect crashes with an assertion when lowering SystemVerilog modules that use `string` type as module ports.

The crash occurs during the MooreToCore conversion pass. The type converter converts Moore's `StringType` to `sim::DynamicStringType`, but this type is not a valid HW dialect port type. When `hw::ModulePortInfo` constructor calls `sanitizeInOut()` to iterate through ports and executes `dyn_cast<hw::InOutType>(p.type)`, the cast operation on an invalid type triggers an assertion failure.

**Crash Type**: assertion
**Dialect**: Moore
**Failing Pass**: MooreToCorePass

## Steps to Reproduce

1. Save the test case below as `test.sv`
2. Run:
   ```bash
   circt-verilog --ir-hw test.sv
   ```

## Test Case

```systemverilog
module test(input string a);
endmodule
```

## Error Output

```
PLEASE submit a bug report to https://github.com/llvm/circt and include the crash backtrace.
Stack dump:
0.	Program arguments: /opt/firtool/bin/circt-verilog --ir-hw bug.sv
 #0 0x00007f44d1ed68a8 llvm::sys::PrintStackTrace(llvm::raw_ostream&, int) (/opt/firtool-1.139.0/bin/../lib/libLLVMSupport.so+0x2008a8)
 #1 0x00007f44d1ed42f5 llvm::sys::RunSignalHandlers() (/opt/firtool-1.139.0/bin/../lib/libLLVMSupport.so+0x1fe2f5)
 #2 0x00007f44d1ed7631 SignalHandler(int, siginfo_t*, void*) Signals.cpp:0:0
 #3 0x00007f44d19e4330 (/lib/x86_64-linux-gnu/libc.so.6+0x45330)
 #4 0x00007f44d60f88ae (anonymous namespace)::SVModuleOpConversion::matchAndRewrite(circt::moore::SVModuleOp, circt::moore::SVModuleOpAdaptor, mlir::ConversionPatternRewriter&) const MooreToCore.cpp:0:0
...
Assertion failed in `ModulePortInfo::sanitizeInOut()` when processing string type port.
```

## Root Cause Analysis

### Core Problem

The crash occurs in `hw::ModulePortInfo::sanitizeInOut()` at line 177 in `PortImplementation.h`. The function iterates through module ports and calls `dyn_cast<hw::InOutType>(p.type)` on each port type.

For string type ports:
1. Moore dialect parses `input string a` as `StringType`
2. Type converter converts `StringType` to `sim::DynamicStringType`
3. `sim::DynamicStringType` is NOT a valid HW dialect port type
4. When `sanitizeInOut()` calls `dyn_cast<hw::InOutType>()` on this invalid type, it fails the assertion: `detail::isPresent(Val) && "dyn_cast on a non-existent value"`

### Evidence

- Test case: `module test(input string a);` (minimal 2-line case)
- Crash location: `hw::ModulePortInfo::sanitizeInOut()` during MooreToCore conversion
- Assertion message: `dyn_cast on a non-existent value`
- Similar pattern to issue #9570 (packed union type), both fail due to missing type conversion rules

### Hypothesis

**High Confidence**: MooreToCore conversion pass lacks a type conversion rule for string types. When the type converter processes string type ports, it produces `sim::DynamicStringType`, which cannot be represented in HW dialect ports.

## Environment

- **CIRCT Version**: firtool-1.139.0
- **OS**: Linux 5.15.0
- **Architecture**: x86_64

## Validation

- **Slang**: Pass (accepts the code)
- **Verilator**: Pass (accepts the code)
- **Icarus Verilog**: Error (iverilog limitation, not IEEE standard)
- **IEEE 1800-2017**: `string` is a valid data type

**Note**: This is valid SystemVerilog code that triggers a CIRCT crash. Other major tools accept it.

## Stack Trace

<details>
<summary>Click to expand stack trace</summary>

```
 #4 0x00007f44d60f88ae (anonymous namespace)::SVModuleOpConversion::matchAndRewrite(circt::moore::SVModuleOp, circt::moore::SVModuleOpAdaptor, mlir::ConversionPatternRewriter&) const MooreToCore.cpp:0:0
 #5 0x00007f44d60f8b93 llvm::LogicalResult mlir::ConversionPattern::dispatchTo1To1<mlir::OpConversionPattern<circt::moore::SVModuleOp>, circt::moore::SVModuleOp>(mlir::OpConversionPattern<circt::moore::SVModuleOp> const&, circt::moore::SVModuleOp, circt::moore::SVModuleOp::GenericAdaptor<llvm::ArrayRef<mlir::ValueRange>>, mlir::ConversionPatternRewriter&) (/opt/firtool-1.139.0/bin/../lib/libCIRCTMooreToCore.so+0x50b93)
 #6 0x00007f44d60f8530 mlir::OpConversionPattern<circt::moore::SVModuleOp>::matchAndRewrite(mlir::Operation*, llvm::ArrayRef<mlir::ValueRange>, mlir::PatternRewriter&) const (/opt/firtool-1.139.0/bin/../lib/libCIRCTMooreToCore.so+0x50530)
 #7 0x00007f44d440a438 mlir::ConversionPattern::matchAndRewrite(mlir::Operation*, mlir::PatternRewriter&) const (/opt/firtool-1.139.0/bin/../lib/libMLIRTransformUtils.so+0x2a438)
 #10 0x00007f44d440bc6f (anonymous namespace)::OperationLegalizer::legalize(mlir::Operation*) DialectConversion.cpp:0:0
 #11 0x00007f44d440b470 mlir::OperationConverter::convert(mlir::Operation*, bool) (/opt/firtool-1.139.0/bin/../lib/libMLIRTransformUtils.so+0x2b470)
 #16 0x00007f44d60ca231 (anonymous namespace)::MooreToCorePass::runOnOperation() MooreToCore.cpp:0:0
```

</details>

## Related Issues

- **#9570** - [Moore] Assertion in MooreToCore when module uses packed union type as port
  - **Similarity**: High (21/30)
  - **Note**: Same assertion failure pattern, but different type (string vs packed union)
  - **Recommendation**: This issue may be related but distinct. Consider reviewing both issues together as they share the same root cause pattern (missing type conversion rules in MooreToCore).

## Suggested Labels

`Moore` `crash` `found-by-fuzzing`

---
*This issue was generated with assistance from an automated bug reporter.*
