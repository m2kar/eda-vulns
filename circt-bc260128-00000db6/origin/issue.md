<!--
  CIRCT Bug Report
  Generated by circt-bug-reporter skill

  Note: This bug may already be reported in #8863. Please review before submitting.
-->

<!-- Title: [Comb] Assertion failure in ExtractOp canonicalization with mixed assign/always_comb array assignments -->

## Description

CIRCT's comb dialect crashes during `ExtractOp` canonicalization when processing a SystemVerilog module with mixed `assign` and `always_comb` blocks performing partial bit assignments to a packed array.

The crash occurs in `extractConcatToConcatExtract` function when it attempts to simplify an `extract(concat(...))` pattern. The canonicalization produces a single-element result and calls `replaceOpAndCopyNamehint`, which subsequently calls `eraseOp` on an operation that still has uses, triggering an assertion failure.

**Crash Type**: assertion_failure
**Dialect**: comb
**Failing Pass**: ExtractOp::canonicalize (comb canonicalization)

**Root Cause**: During canonicalization of `extract(concat(...))` patterns, when the simplification results in a single element, `replaceOpAndCopyNamehint` incorrectly attempts to erase an operation that is still referenced by other IR nodes.

## Steps to Reproduce

1. Save the test case below as `test.sv`
2. Run:
   ```bash
   circt-verilog --ir-hw test.sv
   ```

## Test Case

```systemverilog
module m(input a,b);
  logic [1:0] x;
  assign x[0] = a;
  always_comb x[1] = b;
endmodule
```

## Error Output

```
circt-verilog: /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/mlir/lib/IR/PatternMatch.cpp:156: virtual void mlir::RewriterBase::eraseOp(Operation *): Assertion `op->use_empty() && "expected 'op' to have no uses"' failed.
PLEASE submit a bug report to https://github.com/llvm/circt and include the crash backtrace.
```

## Root Cause Analysis

### Trigger Pattern
The test case uses mixed assignment styles (continuous `assign` and `always_comb`) to perform partial bit assignments on a packed array. This generates an IR pattern involving `extract(concat(...))` operations during comb dialect lowering.

### Failure Point
- **Location**: `lib/Dialect/Comb/CombFolds.cpp:548` in `extractConcatToConcatExtract`
- **Call Chain**: `ExtractOp::canonicalize` → `extractConcatToConcatExtract` → `replaceOpAndCopyNamehint` → `RewriterBase::eraseOp`
- **Assertion**: `op->use_empty() && "expected 'op' to have no uses"`

### Root Cause Hypothesis
When `extractConcatToConcatExtract` detects that `reverseConcatArgs.size() == 1`, it attempts to simplify the extract operation by replacing it with a single value. However, in cases with mixed assignment patterns, the operation being replaced may still have other users in the IR graph. The `replaceOpAndCopyNamehint` function calls `eraseOp` without properly checking for remaining uses, leading to the assertion failure.

### Involved Functions
- `extractConcatToConcatExtract` - CombFolds.cpp:548
- `circt::comb::ExtractOp::canonicalize` - CombFolds.cpp:615
- `circt::replaceOpAndCopyNamehint` - Naming.cpp:82
- `mlir::RewriterBase::eraseOp` - PatternMatch.cpp:156

## Environment

- **CIRCT Version**: firtool-1.139.0 (original bug reported in circt-1.139.0)
- **LLVM Version**: 22.0.0git
- **OS**: Linux
- **Architecture**: x86_64

**Note**: This bug was reported from a fuzzer-generated test case. It may have been fixed in subsequent CIRCT releases.

## Stack Trace

<details>
<summary>Click to expand stack trace</summary>

```
#12 0x0000559ec1920700 circt::replaceOpAndCopyNamehint(mlir::PatternRewriter&, mlir::Operation*, mlir::Value) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/lib/Support/Naming.cpp:82:1
#13 0x0000559ec1518f4f extractConcatToConcatExtract(circt::comb::ExtractOp, circt::comb::ConcatOp, mlir::PatternRewriter&) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/lib/Dialect/Comb/CombFolds.cpp:548:3
#14 0x0000559ec1518f4f circt::comb::ExtractOp::canonicalize(circt::comb::ExtractOp, mlir::PatternRewriter&) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/lib/Dialect/Comb/CombFolds.cpp:615:12
#15 0x0000559ec28eb1f4 mlir::PatternApplicator::matchAndRewrite(mlir::Operation*, mlir::PatternRewriter&, llvm::function_ref<bool (mlir::Pattern const&)>, llvm::function_ref<void (mlir::Pattern const&)>, llvm::function_ref<llvm::LogicalResult (mlir::Pattern const&)>)::$_0::operator()() const /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/mlir/lib/Rewrite/PatternApplicator.cpp:223:13
#17 0x0000559ec28e56c5 mlir::PatternApplicator::matchAndRewrite(mlir::Operation*, mlir::PatternRewriter&, llvm::function_ref<bool (mlir::Pattern const&)>, llvm::function_ref<void (mlir::Pattern const&)>, llvm::function_ref<llvm::LogicalResult (mlir::Pattern const&)>) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/mlir/lib/Rewrite/PatternApplicator.cpp:242:9
#19 0x0000559ec28bf2eb (anonymous namespace)::GreedyPatternRewriteDriver::processWorklist() /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/mlir/lib/Transforms/Utils/GreedyPatternRewriteDriver.cpp:621:9
#24 0x0000559ec28ba5c0 mlir::applyPatternsGreedily(mlir::Region&, mlir::FrozenRewritePatternSet const&, mlir::GreedyRewriteConfig, bool*) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/mlir/lib/Transforms/Utils/GreedyPatternRewriteDriver.cpp:934:47
#26 0x0000559ec2860320 mlir::applyPatternsGreedily(mlir::Operation*, mlir::FrozenRewritePatternSet const&, mlir::GreedyRewriteConfig, bool*) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/mlir/include/mlir/Transforms/GreedyPatternRewriteDriver.h:225:20
```

</details>

## Related Issues

**⚠️ POTENTIAL DUPLICATE**: This issue appears to be highly similar to **#8863** "[Comb] Concat/extract canonicalizer crashes on loop"

Both issues involve:
- Same assertion failure: `expected 'op' to have no uses`
- Same crash location: `extractConcatToConcatExtract` → `replaceOpAndCopyNamehint` → `eraseOp`
- Same MLIR dialect: `comb`
- Same canonicalization pass: `ExtractOp::canonicalize`

**Similarity Score**: 13.5/15 (90% match)

Before submitting, please review #8863 to determine if:
1. This is a duplicate of the existing issue
2. This is a new test case that should be added to #8863
3. This is a distinct variant that warrants a separate issue

## Validation

| Check | Result |
|-------|--------|
| **Syntax Valid** | ✅ slang + verilator: 0 errors, 0 warnings |
| **Features Supported** | ✅ packed_array, partial_bit_assignment, continuous_assignment, always_comb |
| **Test Case Minimized** | ✅ 36.4% size reduction from original |

## Additional Notes

- **Reproducibility**: Deterministic (fuzzer-generated test case)
- **Severity**: High (crashes the compiler)
- **Found By**: Fuzzing (FeatureFuzz-SV)

---
*This issue was generated with assistance from an automated bug reporter.*
