<!--
  CIRCT Bug Report
  Generated by circt-bug-reporter skill
-->

<!-- Title: [Arc] Assertion failure in InferStateProperties::applyEnableTransformation with packed struct array enable -->

## Description

`arcilator` aborts with an assertion failure in the Arc dialect's `InferStateProperties` pass when processing SystemVerilog designs containing packed struct arrays with enable signals. The crash occurs in `applyEnableTransformation` when attempting to create an `hw.constant` with an enable signal type that is not `mlir::IntegerType`.

**Crash Type**: Assertion failure
**Dialect**: Arc (via SystemVerilog → HW → Arc lowering)
**Failing Pass**: InferStateProperties::applyEnableTransformation
**Root Cause**: The pass assumes enable types are always `IntegerType`, but packed struct array lowering produces non-`IntegerType` enable signals (e.g., `hw::IntType`), causing `hw::ConstantOp::create` to fail with a type cast assertion.

## Steps to Reproduce

1. Save the test case below as `test.sv`
2. Run the following command:
   ```bash
   /edazz/FeatureFuzz-SV/target/circt-1.139.0/bin/circt-verilog --ir-hw test.sv | /edazz/FeatureFuzz-SV/target/circt-1.139.0/bin/arcilator
   ```

## Test Case

```systemverilog
typedef struct packed {
  logic valid;
} packet_t;

module array_processor(
  input logic clk,
  input logic start,
  output logic done
);

  packet_t packet_array [0:0];
  logic counter;

  always_ff @(posedge clk) begin
    if (start) begin
      packet_array[0].valid <= 1'b1;
    end
  end

  always_ff @(posedge clk) begin
    if (start)
      counter <= 1'b0;
    else
      counter <= ~counter;
  end

  assign done = counter;

endmodule
```

## Error Output

```
arcilator: /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/include/llvm/Support/Casting.h:566: decltype(auto) llvm::cast(From &) [To = mlir::IntegerType, From = mlir::Type]: Assertion `isa<To>(Val) && "cast<Ty>() argument of incompatible type!"' failed.
PLEASE submit a bug report to https://github.com/llvm/llvm-project/issues/ and include the crash backtrace and instructions to reproduce bug.
Stack dump:
0.	Program arguments: /edazz/FeatureFuzz-SV/target/circt-1.139.0/bin/arcilator
 #12 0x000055e8eab9aa5f circt::hw::ConstantOp::create(mlir::OpBuilder&, mlir::Location, mlir::Type, long) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/build/tools/circt/include/circt/Dialect/HW/HW.cpp.inc:2591:55
 #17 0x000055e8ea1e1382 applyEnableTransformation(circt::arc::DefineOp, circt::arc::StateOp, llvm::ArrayRef<(anonymous namespace)::EnableInfo>) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/lib/Dialect/Arc/Transforms/InferStateProperties.cpp:211:55
...
```

## Root Cause Analysis

The `InferStateProperties` pass in the Arc dialect synthesizes enable signals for state operations using `hw::ConstantOp::create`. This function internally casts the provided type to `mlir::IntegerType`, which will fail if the type is a dialect-specific integer type like `hw::IntType`.

When processing SystemVerilog packed struct arrays (or other aggregate types), the enable signals derived from these states may not be `IntegerType`. Specifically:
- Packed struct arrays can lower to internal `hw::IntType` or aggregate types
- The `applyEnableTransformation` function (line 211 of `InferStateProperties.cpp`) attempts to create constants for these enable signals
- `hw::ConstantOp::create` performs an unconditional `cast<IntegerType>` which asserts when given non-`IntegerType`

**Hypothesis**: The `applyEnableTransformation` function needs to either:
1. Normalize/convert enable types to `IntegerType` before creating constants
2. Use a constant creation method that handles `hw::IntType` explicitly
3. Guard against non-integer enable types and handle them differently

## Environment

- **CIRCT Version**: circt-1.139.0 (legacy)
- **OS**: Linux
- **Architecture**: x86_64
- **Test Case Validation**: Verilator lint-only check passed
- **Reproducibility**: 3/3 attempts (100% consistent crash)
- **Test Case Reduction**: 53.1% size reduction from original

## Stack Trace

<details>
<summary>Click to expand stack trace</summary>

```
arcilator: /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/include/llvm/Support/Casting.h:566: decltype(auto) llvm::cast(From &) [To = mlir::IntegerType, From = mlir::Type]: Assertion `isa<To>(Val) && "cast<Ty>() argument of incompatible type!"' failed.
PLEASE submit a bug report to https://github.com/llvm/llvm-project/issues/ and include the crash backtrace and instructions to reproduce bug.
Stack dump:
0.	Program arguments: /edazz/FeatureFuzz-SV/target/circt-1.139.0/bin/arcilator
 #12 0x000055e8eab9aa5f circt::hw::ConstantOp::create(mlir::OpBuilder&, mlir::Location, mlir::Type, long) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/build/tools/circt/include/circt/Dialect/HW/HW.cpp.inc:2591:55
 #17 0x000055e8ea1e1382 applyEnableTransformation(circt::arc::DefineOp, circt::arc::StateOp, llvm::ArrayRef<(anonymous namespace)::EnableInfo>) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/lib/Dialect/Arc/Transforms/InferStateProperties.cpp:211:55
 #18 0x000055e8ea1e1382 (anonymous namespace)::InferStatePropertiesPass::runOnStateOp(circt::arc::StateOp, circt::arc::DefineOp, llvm::DenseMap<circt::arc::DefineOp, unsigned int, llvm::DenseMapInfo<circt::arc::DefineOp, void>, llvm::detail::DenseMapPair<circt::arc::DefineOp, unsigned int>>&) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/lib/Dialect/Arc/Transforms/InferStateProperties.cpp:454:17
 #24 0x000055e8ea1dec5c (anonymous namespace)::InferStatePropertiesPass::runOnOperation() /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/lib/Dialect/Arc/Transforms/InferStateProperties.cpp:401:1
 #32 0x000055e8e99622d3 processBuffer(mlir::MLIRContext&, mlir::TimingScope&, llvm::SourceMgr&, std::optional<std::unique_ptr<llvm::ToolOutputFile, std::default_delete<llvm::ToolOutputFile>>>&) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/tools/arcilator/arcilator.cpp:330:7
```

</details>

## Related Issues

- **#9467**: [circt-verilog][arcilator] `arcilator` fails to lower `llhd.constant_time` generated from simple SV delay (`#1`) - Similar arcilator SV lowering context, but different specific error
- **#8286**: [circt-verilog][llhd][arcilator] Verilog-to-LLVM lowering issues - Broader Verilog-to-LLVM lowering issues in arcilator
- **#8930**: [MooreToCore] Crash with sqrt/floor - Generic IntegerType assertion crash in different dialect

**Note**: Issue #9467 (similarity score: 13/30) may represent a related issue in arcilator's SV lowering pipeline. Manual review recommended to determine if these are manifestations of the same underlying bug.

---
*This issue was generated with assistance from an automated bug reporter.*
