<!-- 
  CIRCT Bug Report
  Generated by circt-bug-reporter workflow
  Crash ID: circt-bc260129-000016a2
-->

<!-- Title: [Arc] Assertion failure in LowerState when processing inout ports with tri-state logic -->

## Description

`arcilator` crashes with an assertion failure when processing SystemVerilog code that contains an `inout` port with tri-state assignment (e.g., `assign io = 1'bz`). The crash occurs in the Arc dialect's `LowerStatePass` when attempting to create a `StateType` for an LLHD reference type (`!llhd.ref<i1>`).

The root cause is that `circt-verilog` converts inout ports with tri-state logic to LLHD reference types, but `arcilator`'s `StateType::get()` only supports types with known bit widths (IntegerType, hw::ArrayType, hw::StructType, seq::ClockType). The `!llhd.ref<i1>` type is a reference type that doesn't have a simple bit width, causing the `verifyInvariants` assertion to fail.

**Crash Type**: Assertion failure  
**Dialect**: Arc  
**Failing Pass**: LowerState  
**Component**: arcilator

## Steps to Reproduce

1. Save the test case below as `test.sv`
2. Run:
   ```bash
   circt-verilog --ir-hw test.sv | arcilator
   ```

## Test Case

```systemverilog
module bug(inout io);
  assign io = 1'bz;
endmodule
```

## Error Output

```
<unknown>:0: error: state type must have a known bit width; got '!llhd.ref<i1>'
arcilator: .../mlir/include/mlir/IR/StorageUniquerSupport.h:180: 
  static ConcreteT mlir::detail::StorageUserBase<circt::arc::StateType, ...>::get(...): 
  Assertion `succeeded( ConcreteT::verifyInvariants(getDefaultDiagnosticEmitFn(ctx), args...))' failed.
PLEASE submit a bug report to https://github.com/llvm/llvm-project/issues/ and include the crash backtrace.
```

## Root Cause Analysis

### Problem Location

The crash occurs at `LowerState.cpp:219` in `ModuleLowering::run()`:

```cpp
for (auto arg : moduleOp.getBodyBlock()->getArguments()) {
  auto name = moduleOp.getArgName(arg.getArgNumber());
  auto state = RootInputOp::create(allocBuilder, arg.getLoc(),
      StateType::get(arg.getType()), name, storageArg);  // <-- CRASH HERE
  allocatedInputs.push_back(state);
}
```

When `arg.getType()` is `!llhd.ref<i1>` (from an inout port), `StateType::get()` fails because `computeLLVMBitWidth()` in `ArcTypes.cpp` doesn't handle LLHD reference types.

### Type Flow

1. **SystemVerilog**: `inout logic io` with `assign io = 1'bz`
2. **circt-verilog**: Converts to HW IR with `!llhd.ref<i1>` type for multi-driver handling
3. **arcilator**: `StateType::get(!llhd.ref<i1>)` → assertion failure

### Suggested Fix

Option 1: Add input validation in `LowerState.cpp` to reject unsupported types gracefully:
```cpp
if (isa<llhd::RefType>(arg.getType())) {
  return emitError() << "arcilator does not support inout ports with tri-state logic";
}
```

Option 2: Extend `computeLLVMBitWidth()` to handle `llhd::RefType` by extracting the underlying type's bit width.

## Environment

- **CIRCT Version**: firtool-1.139.0
- **LLVM Version**: 22.0.0git
- **slang Version**: 9.1.0+0
- **OS**: Linux (x86_64)

## Validation

The test case is **valid SystemVerilog** verified by:
- ✅ Verilator (`verilator --lint-only`): PASS
- ✅ slang (`slang --lint-only`): PASS (0 errors, 0 warnings)

## Stack Trace

<details>
<summary>Click to expand full stack trace</summary>

```
 #0 llvm::sys::PrintStackTrace(llvm::raw_ostream&, int)
 #1 llvm::sys::RunSignalHandlers()
 #2 SignalHandler(int, siginfo_t*, void*)
 #3-#10 [libc signal handling]
#11 circt::arc::StateType::get(mlir::Type) at ArcTypes.cpp.inc:108
#12 (anonymous namespace)::ModuleLowering::run() at LowerState.cpp:219
#13 (anonymous namespace)::LowerStatePass::runOnOperation() at LowerState.cpp:1198
#14 mlir::detail::OpToOpPassAdaptor::run() at Pass.cpp
#15-#21 [MLIR pass infrastructure]
#22 processBuffer() at arcilator.cpp:330
#23 processInputSplit() at arcilator.cpp:546
#24 processInput() at arcilator.cpp:562
#25 executeArcilator() at arcilator.cpp:629
#26-#28 main() at arcilator.cpp:697
```

</details>

## Related Issues

- **#9574**: [Arc] Assertion failure when lowering inout ports in sequential logic
  - Similarity: 9.5/10 (near-exact match)
  - Same error message, same crash location, same root cause
  - **This may be a duplicate of #9574**

## Additional Notes

- **Duplicate Check**: This issue appears to be closely related to or a duplicate of #9574, which reports the same assertion failure with inout ports
- **Test Case Reduction**: Original test case was 20 lines, minimized to 3 lines (85% reduction)
- **Impact**: Affects any SystemVerilog design using inout ports with tri-state logic when processed through arcilator

---
*This issue was generated with assistance from an automated bug reporter.*
