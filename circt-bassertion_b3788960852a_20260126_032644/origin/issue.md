# [MooreToCore] Crash when module has string type output port

## Summary

`circt-verilog --ir-hw` crashes with a segmentation fault when processing a SystemVerilog module that has a `string` type output port. The crash occurs during the MooreToCore dialect conversion pass.

## Reproduction

### Minimal Test Case (`bug.sv`)

```systemverilog
module test(output string msg);
  assign msg = "Test";
endmodule
```

### Command

```bash
circt-verilog --ir-hw bug.sv
```

### Environment

- **CIRCT Version**: firtool-1.139.0
- **LLVM Version**: 22.0.0git
- **slang Version**: 9.1.0

### Expected Behavior

CIRCT should either:
1. Support string ports for simulation flows, or
2. Emit a clear error message indicating that string type ports are not supported in hardware synthesis

### Actual Behavior

The tool crashes with a segmentation fault:

```
PLEASE submit a bug report to https://github.com/llvm/circt and include the crash backtrace.
Stack dump:
0.	Program arguments: circt-verilog --ir-hw bug.sv
 #4 SVModuleOpConversion::matchAndRewrite() MooreToCore.cpp:0:0
 #5 ConversionPattern::dispatchTo1To1<SVModuleOp>
 ...
 #16 MooreToCorePass::runOnOperation() MooreToCore.cpp:0:0
```

## Root Cause Analysis

### Location

- **File**: `lib/Conversion/MooreToCore/MooreToCore.cpp`
- **Function**: `getModulePortInfo()` (line ~243)
- **Pass**: MooreToCore conversion

### Mechanism

1. Moore dialect `StringType` is converted to `sim::DynamicStringType` (line 2277-2279)
2. `getModulePortInfo()` uses this converted type to construct `hw::PortInfo`
3. `sim::DynamicStringType` is not a valid hardware port type
4. The invalid type causes a crash when constructing `hw::ModulePortInfo`

### Relevant Code

```cpp
// Type conversion (works correctly)
typeConverter.addConversion([&](StringType type) {
  return sim::DynamicStringType::get(type.getContext());
});

// Port info construction (crashes)
static hw::ModulePortInfo getModulePortInfo(...) {
  for (auto port : moduleTy.getPorts()) {
    Type portTy = typeConverter.convertType(port.type);  // Returns sim::DynamicStringType
    // No validation that portTy is a valid hw:: type
    ports.push_back(hw::PortInfo({{port.name, portTy, port.dir}, ...}));  // CRASH
  }
}
```

## Test Case Validity

| Tool | Result | Notes |
|------|--------|-------|
| slang v10.0.6 | ✅ PASS | Valid SystemVerilog |
| Verilator | ✅ PASS | No lint errors |
| Icarus Verilog | ⚠️ FAIL | Tool limitation (not spec violation) |

The test case is valid SystemVerilog per IEEE 1800-2017. String type ports are allowed in the language specification, though they are simulation-only (non-synthesizable).

## Suggested Fix

Add validation in `getModulePortInfo()` to check if converted port types are valid hardware types:

```cpp
Type portTy = typeConverter.convertType(port.type);
if (!portTy || isa<sim::DynamicStringType>(portTy)) {
  // Emit error: string type ports are not supported in hardware synthesis
  return op.emitError("unsupported port type: string ports cannot be converted to hardware");
}
```

## Related Issues

- **#8332**: [MooreToCore] Support for StringType from moore to llvm dialect - This is the root issue tracking StringType support
- **#8283**: [ImportVerilog] Cannot compile forward declared string type - Related string handling issue

## Note on Duplicates

This crash is a manifestation of the missing StringType support tracked in issue #8332. The fix for #8332 (proper StringType support) would also resolve this crash. This issue provides additional context about the specific crash scenario with string ports.

---

*This report was auto-generated by CIRCT Bug Reporter. Crash ID: bassertion_b3788960852a_20260126_032644*
