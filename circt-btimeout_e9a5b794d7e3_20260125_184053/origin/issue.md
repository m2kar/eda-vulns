<!--
  CIRCT Bug Report
  Generated by circt-bug-reporter workflow
-->

<!-- Title: [circt-verilog] Timeout when compiling SystemVerilog with packed struct partial field updates -->

## Description

CIRCT's `circt-verilog --ir-hw` command times out after 60 seconds when processing a minimal SystemVerilog module containing a packed struct with partial field updates in an `always_comb` block. The timeout occurs during compilation of a tiny 19-line module, strongly suggesting a pathological case in the compiler's handling of partial aggregate updates rather than normal compilation overhead.

The most plausible bottleneck is in the arcilator stage when handling partial updates of packed struct fields across `always_ff`/`always_comb`, leading to a scheduling or dependency-resolution loop that fails to converge.

**Crash Type**: timeout
**Dialect**: Moore (SystemVerilog parsing)
**Failing Pass**: circt-verilog --ir-hw (pre-IR conversion)

## Steps to Reproduce

1. Save the test case below as `test.sv`
2. Run:
   ```bash
   timeout 60s /opt/firtool/bin/circt-verilog --ir-hw test.sv | /opt/firtool/bin/arcilator | /opt/firtool/bin/opt -O0 | /opt/firtool/bin/llc -O0 --filetype=obj -o /tmp/bug.o
   ```

The compilation will timeout after 60 seconds in the `circt-verilog --ir-hw` stage.

## Test Case

```systemverilog
module test_module(
  input logic clk,
  input logic a,
  output logic out
);
  typedef struct packed {
    logic field1;
    logic field2;
  } my_struct_t;
  my_struct_t my_struct;
  logic q;
  always_ff @(posedge clk) begin
    q <= a;
  end
  always_comb begin
    my_struct.field2 = q;
  end
  assign out = my_struct.field1;
endmodule
```

**Minimization Details**:
- Original test case: 40 lines
- Minimized test case: 19 lines
- Reduction: 52.5%

## Error Output

```
timeout: the monitored command dumped core
timeout 60s /opt/firtool/bin/circt-verilog --ir-hw bug.sv 2>&1
```

The command times out after 60 seconds with no error message or output produced.

## Root Cause Analysis

### Hypothesis 1 (High Confidence)
**Cause**: arcilator's scheduling/dependency resolution on aggregate updates fails to converge due to partial packed-struct assignment, leading to repeated reconstruction or fixpoint iteration.

**Evidence**:
- Timeout on a trivially small design suggests an algorithmic loop rather than normal compilation cost
- The test case includes a partial update of a packed struct field, a known source of aggregate insert/extract and dependency scheduling complexity
- arcilator is the most specialized stage in the pipeline; LLVM `opt/llc -O0` should not take 60s on tiny IR

**Mechanism**: A dependency graph is built over aggregate components. Partial update may create a self-dependency (struct depends on itself for unchanged fields), causing repeated rebuilding or a non-terminating scheduling loop.

### Hypothesis 2 (Medium Confidence)
**Cause**: circt-verilog lowering from SV packed struct + always_comb to HW/Seq emits a pathological pattern (e.g., recursive aggregate composition) that later stages cannot simplify.

**Evidence**:
- Partial aggregate update requires reconstruction; if lowering introduces nested inserts or redundant ops, it could blow up or loop in subsequent passes

**Mechanism**: Lowering uses repeated `hw.struct_insert`-like patterns that are then repeatedly canonicalized or expanded without termination.

## Environment

- **CIRCT Version**: unknown (tools from /opt/firtool/bin/)
- **OS**: Linux
- **Architecture**: x86_64

## Stack Trace

No stack trace available - the compilation times out without producing a core dump or assertion failure.

## Related Issues

Based on duplicate analysis, the following issues show high similarity:

- **#8286** - [circt-verilog][llhd][arcilator] Verilog-to-LLVM lowering issues (Score: 11.5)
- **#9467** - [circt-verilog][arcilator] `arcilator` fails to lower `llhd.constant_time` generated from simple SV delay (`#1`) (Score: 9.0)
- **#6373** - [Arc] Support hw.wires of aggregate types (Score: 6.0)

**Note**: This issue differs from #8286 in that the timeout occurs at the `circt-verilog --ir-hw` stage (pre-IR), whereas #8286 describes issues in the verilog-to-LLVM lowering pipeline. However, both issues involve arcilator and aggregate handling, suggesting a common underlying problem area.

## Validation

| Check | Result |
|-------|--------|
| Syntax Check | valid (slang: 0 errors, 0 warnings) |
| Feature Support | supported (all constructs are standard SV) |
| Cross-Tool Validation | slang: pass |
| Classification | **report** (legitimate compiler bug) |

The test case is valid SystemVerilog code that causes a unique timeout in CIRCT's compilation pipeline.

## Keywords

arcilator, packed struct, partial assignment, aggregate insert, always_comb, scheduling fixpoint, timeout, hw.struct, arc, circt-verilog, Moore

## Suggested Fix Directions

1. **Guard arcilator scheduling fixpoint**: Add convergence checks and cycle detection for aggregate partial updates; ensure unchanged fields do not introduce self-dependencies.
2. **Canonicalize aggregate updates early**: Lower packed-struct field assignments into explicit struct_create with constants + signals, avoiding insert-on-self patterns.
3. **Add a minimal regression**: Include this SV snippet to test arcilator scheduling termination and runtime.

---

*This issue was generated with assistance from an automated bug reporter.*
