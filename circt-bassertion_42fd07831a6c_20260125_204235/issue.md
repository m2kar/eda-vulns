<!--
  CIRCT Bug Report
  Generated by circt-bug-reporter skill
-->

<!-- Title: [Moore] Assertion failure in MooreToCore with string type port -->

## Description

**circt-verilog** crashes with an assertion failure when processing a SystemVerilog module that has a `string` type port (e.g., `output string str`). The bug occurs in the MooreToCore conversion pass when creating `hw::ModulePortInfo` - the `sanitizeInOut()` function attempts to `dyn_cast<hw::InOutType>` on a `sim::DynamicStringType`, which triggers an assertion because this type is not recognized in the HW dialect's type casting system.

**Crash Type**: assertion
**Dialect**: Moore
**Failing Pass**: MooreToCorePass

## Steps to Reproduce

1. Save the test case below as `test.sv`
2. Run:
   ```bash
   circt-verilog --ir-hw bug.sv
   ```

## Test Case

```systemverilog
module test(output string str);
endmodule
```

## Error Output

```
circt-verilog: /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/include/llvm/Support/Casting.h:650: decltype(auto) llvm::dyn_cast(From &) [To = circt::hw::InOutType, From = mlir::Type]: Assertion `detail::isPresent(Val) && "dyn_cast on a non-existent value"' failed.
PLEASE submit a bug report to https://github.com/llvm/circt and include the crash backtrace.
Stack dump:
0.	Program arguments: /edazz/FeatureFuzz-SV/target/circt-1.139.0/bin/circt-verilog --ir-hw bug.sv
 #0 0x000055e9be81532f llvm::sys::PrintStackTrace(llvm::raw_ostream&, int) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/lib/Support/Unix/Signals.inc:842:13
 #1 0x000055e9be8162e9 llvm::sys::RunSignalHandlers() /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/lib/Support/Signals.cpp:109:18
 #2 0x000055e9be8162e9 SignalHandler(int, siginfo_t*, void*) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/lib/Support/Unix/Signals.inc:412:3
 #3 0x00007f75d1b8f330 (/lib/x86_64-linux-gnu/libc.so.6+0x45330)
 #4 0x00007f75d1be8b2c __pthread_kill_implementation ./nptl/pthread_kill.c:44:76
...
```

## Root Cause Analysis

### Hypothesis 1 (High Confidence) ⭐

**Cause**: The `hw::ModulePortInfo::sanitizeInOut()` function assumes all port types are HW-compatible, but `sim::DynamicStringType` is from the `sim` dialect and is not properly handled.

**Evidence**:
1. Test case has `output string str` port
2. `StringType` converts to `sim::DynamicStringType` successfully
3. Assertion fails at `dyn_cast<hw::InOutType>` in `sanitizeInOut()`
4. `sim::DynamicStringType` is not a subtype of HW types

**Mechanism**:
The LLVM casting infrastructure's `detail::isPresent()` check fails because `sim::DynamicStringType` doesn't have the type registration needed for HW dialect's `InOutType` cast to work safely. The `dyn_cast` expects types that are at least part of the same type hierarchy.

**Processing Path**:
1. Parse SystemVerilog: `output string str`
2. Create Moore dialect: `StringType` for port
3. MooreToCore conversion: convertType → sim::DynamicStringType
4. getModulePortInfo(): Create hw::PortInfo with sim::DynamicStringType
5. ModulePortInfo constructor: Call sanitizeInOut()
6. sanitizeInOut(): dyn_cast<hw::InOutType>(sim::DynamicStringType)
7. **CRASH**: Assertion "dyn_cast on a non-existent value" fails

### Crash Location

**File**: `lib/Conversion/MooreToCore/MooreToCore.cpp`
**Function**: `getModulePortInfo()`
**Line**: 259 (return statement, but issue originates at line 243)

## Environment

- **CIRCT Version**: circt-verilog
- **OS**: Linux 5.15.0-164-generic
- **Architecture**: x86_64

## Stack Trace

<details>
<summary>Click to expand stack trace</summary>

```
 #11 0x000055e9bcf90874 mlir::TypeStorage::getAbstractType() /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/../mlir/include/mlir/IR/TypeSupport.h:173:5
 #12 0x000055e9bcf90874 mlir::Type::getTypeID() /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/../mlir/include/mlir/IR/Types.h:101:37
 #13 0x000055e9bcf90874 bool mlir::detail::StorageUserBase<circt::hw::InOutType, mlir::Type, circt::hw::detail::InOutTypeStorage, mlir::detail::TypeUniquer>::classof<mlir::Type>(mlir::Type) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/../mlir/include/mlir/IR/StorageUniquerSupport.h:113:16
 #14 0x000055e9bcf90874 llvm::CastInfo<circt::hw::InOutType, mlir::Type, void>::isPossible(mlir::Type) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/../mlir/include/mlir/IR/Types.h:374:14
 #15 0x000055e9bcf90874 llvm::DefaultDoCastIfPossible<circt::hw::InOutType, mlir::Type, llvm::CastInfo<circt::hw::InOutType, mlir::Type, void>>::doCastIfPossible(mlir::Type) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/include/llvm/Support/Casting.h:311:10
 #16 0x000055e9bcf90874 decltype(auto) llvm::dyn_cast<circt::hw::InOutType, mlir::Type>(mlir::Type&) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/include/llvm/Support/Casting.h:651:10
 #17 0x000055e9bcf90874 circt::hw::ModulePortInfo::sanitizeInOut() /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/include/circt/Dialect/HW/PortImplementation.h:177:24
 #18 0x000055e9bd288753 llvm::SmallVectorTemplateCommon<circt::hw::PortInfo, void>::begin() /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/include/llvm/ADT/SmallVector.h:271:45
 #19 0x000055e9bd288753 llvm::SmallVectorTemplateCommon<circt::hw::PortInfo, void>::end() /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/include/llvm/ADT/SmallVector.h:273:27
 #20 0x000055e9bd288753 llvm::SmallVector<circt::hw::PortInfo, 1u>::~SmallVector() /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/include/llvm/ADT/SmallVector.h:1209:46
 #21 0x000055e9bd288753 (anonymous namespace)::getModulePortInfo(mlir::TypeConverter const&, circt::moore::SVModuleOp) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/lib/Conversion/MooreToCore/MooreToCore.cpp:259:1
 #22 0x000055e9bd288753 (anonymous namespace)::SVModuleOpConversion::matchAndRewrite(circt::moore::SVModuleOp, circt::moore::SVModuleOpAdaptor, mlir::ConversionPatternRewriter&) const /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/lib/Conversion/MooreToCore/MooreToCore.cpp:276:32
 #23 0x000055e9bd288a81 llvm::LogicalResult mlir::ConversionPattern::dispatchTo1To1<mlir::OpConversionPattern<circt::moore::SVModuleOp>, circt::moore::SVModuleOp>(mlir::OpConversionPattern<circt::moore::SVModuleOp> const&, circt::moore::SVModuleOp, circt::moore::SVModuleOp::GenericAdaptor<llvm::ArrayRef<mlir::ValueRange>>, mlir::ConversionPatternRewriter&) /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/../mlir/include/mlir/Transforms/DialectConversion.h:0:15
 #24 0x000055e9bd288515 mlir::OpConversionPattern<circt::moore::SVModuleOp>::matchAndRewrite(mlir::Operation*, llvm::ArrayRef<mlir::ValueRange>, mlir::ConversionPatternRewriter&) const /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/../mlir/include/mlir/Transforms/DialectConversion.h:715:3
 #25 0x000055e9be2a58ac mlir::ConversionPattern::matchAndRewrite(mlir::Operation*, mlir::PatternRewriter&) const /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/mlir/lib/Transforms/Utils/DialectConversion.cpp:2404:1
...
```

</details>

## Related Issues

- #8930: [MooreToCore] Crash with sqrt/floor
- #8382: [FIRRTL] Crash with fstring type on port
- #8176: [MooreToCore] Crash when getting values to observe

---
*This issue was generated with assistance from an automated bug reporter.*
