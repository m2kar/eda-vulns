<!--
  CIRCT Bug Report
  Generated by circt-bug-reporter skill
-->

<!-- Title: [Moore] Assertion failure in MooreToCore when lowering packed union types as module ports -->

## Description

circt-verilog crashes when processing SystemVerilog modules with **packed union types** used as module port types. The MooreToCore conversion pass lacks a type converter for `moore::UnionType`, causing `typeConverter.convertType()` to return a null type. This null type is then used in a `dyn_cast<hw::InOutType>()` call, triggering assertion "dyn_cast on a non-existent value".

**Crash Type**: assertion
**Dialect**: Moore
**Failing Pass**: MooreToCorePass

## Steps to Reproduce

1. Save the test case below as `test.sv`
2. Run:
   ```bash
   /opt/firtool/bin/circt-verilog --ir-hw test.sv
   ```

## Test Case

```systemverilog
typedef union packed { logic a; } my_union;
module Sub(input my_union x);
endmodule
```

## Error Output

```
PLEASE submit a bug report to https://github.com/llvm/circt and include the crash backtrace.
Stack dump:
0.	Program arguments: /opt/firtool/bin/circt-verilog --ir-hw /home/zhiqing/edazz/eda-vulns/circt-bassertion_03ce98b35955_20260125_204541/origin/bug.sv
 #4 0x00007f76f9ffa8ae (anonymous namespace)::SVModuleOpConversion::matchAndRewrite(circt::moore::SVModuleOp, circt::moore::SVModuleOpAdaptor, mlir::ConversionPatternRewriter&) const MooreToCore.cpp:0:0
...
```

## Root Cause Analysis

### Hypothesis 1 (High Confidence)
**Cause**: The MooreToCore pass does not implement type conversion for `moore::UnionType` and `moore::UnpackedUnionType`.

**Evidence**:
- No `addConversion` call for `UnionType` in `populateTypeConversion()`
- `StructType` has a converter but `UnionType` does not
- Stack trace shows crash in `getModulePortInfo` -> `convertType`
- Test case uses packed union as module port type

**Mechanism**: When converting `SVModuleOp` to `hw::HWModuleOp`, `getModulePortInfo()` calls `typeConverter.convertType()` for each port. For `UnionType` ports, this returns null because no converter is registered. The null type is later used in `dyn_cast`, triggering the assertion.

## Environment

- **CIRCT Version**: firtool-1.139.0
- **OS**: Linux 5.15.0
- **Architecture**: x86_64
- **LLVM Version**: 22.0.0git

## Stack Trace

<details>
<summary>Click to expand stack trace</summary>

```
PLEASE submit a bug report to https://github.com/llvm/circt and include the crash backtrace.
Stack dump:
0.	Program arguments: /opt/firtool/bin/circt-verilog --ir-hw /home/zhiqing/edazz/eda-vulns/circt-bassertion_03ce98b35955_20260125_204541/origin/bug.sv
 #0 0x00007f76f5dd88a8 llvm::sys::PrintStackTrace(llvm::raw_ostream&, int) (/opt/firtool-1.139.0/bin/../lib/libLLVMSupport.so+0x2008a8)
 #1 0x00007f76f5dd62f5 llvm::sys::RunSignalHandlers() (/opt/firtool-1.139.0/bin/../lib/libLLVMSupport.so+0x1fe2f5)
 #2 0x00007f76f5dd9631 SignalHandler(int, siginfo_t*, void*) Signals.cpp:0:0
 #3 0x00007f76f58e6330 (/lib/x86_64-linux-gnu/libc.so.6+0x45330)
 #4 0x00007f76f9ffa8ae (anonymous namespace)::SVModuleOpConversion::matchAndRewrite(circt::moore::SVModuleOp, circt::moore::SVModuleOpAdaptor, mlir::ConversionPatternRewriter&) const MooreToCore.cpp:0:0
 #5 0x00007f76f9ffab93 llvm::LogicalResult mlir::ConversionPattern::dispatchTo1To1<mlir::OpConversionPattern<circt::moore::SVModuleOp>, circt::moore::SVModuleOp>(mlir::OpConversionPattern<circt::moore::SVModuleOp> const&, circt::moore::SVModuleOp, circt::moore::SVModuleOp::GenericAdaptor<llvm::ArrayRef<mlir::ValueRange>>, mlir::ConversionPatternRewriter&) (/opt/firtool-1.139.0/bin/../lib/libCIRCTMooreToCore.so+0x50b93)
 #6 0x00007f76f9ffa530 mlir::OpConversionPattern<circt::moore::SVModuleOp>::matchAndRewrite(mlir::Operation*, llvm::ArrayRef<mlir::ValueRange>, mlir::ConversionPatternRewriter&) const (/opt/firtool-1.139.0/bin/../lib/libCIRCTMooreToCore.so+0x50530)
 #7 0x00007f76f830c438 mlir::ConversionPattern::matchAndRewrite(mlir::Operation*, mlir::PatternRewriter&) const (/opt/firtool-1.139.0/bin/../lib/libMLIRTransformUtils.so+0x2a438)
 #8 0x00007f76f82d68ed void llvm::function_ref<void ()>::callback_fn<mlir::PatternApplicator::matchAndRewrite(mlir::Operation*, mlir::PatternRewriter&, llvm::function_ref<bool (mlir::Pattern const&)>, llvm::function_ref<void (mlir::Pattern const&)>, llvm::function_ref<llvm::LogicalResult (mlir::Pattern const&)>)::$_0>(long) PatternApplicator.cpp:0:0
 #9 0x00007f76f82d3774 mlir::PatternApplicator::matchAndRewrite(mlir::Operation*, mlir::PatternRewriter&, llvm::function_ref<bool (mlir::Pattern const&)>, llvm::function_ref<void (mlir::Pattern const&)>, llvm::function_ref<llvm::LogicalResult (mlir::Pattern const&)>) (/opt/firtool-1.139.0/bin/../lib/libMLIRRewrite.so+0x7774)
#10 0x00007f76f830dc6f (anonymous namespace)::OperationLegalizer::legalize(mlir::Operation*) DialectConversion.cpp:0:0
#11 0x00007f76f830d470 mlir::OperationConverter::convert(mlir::Operation*, bool) (/opt/firtool-1.139.0/bin/../lib/libMLIRTransformUtils.so+0x2b470)
#12 0x00007f76f830ddae mlir::OperationConverter::convertOperations(llvm::ArrayRef<mlir::Operation*>) (/opt/firtool-1.139.0/bin/../lib/libMLIRTransformUtils.so+0x2bdae)
#13 0x00007f76f831b8e4 void llvm::function_ref<void ()>::callback_fn<applyConversion(llvm::ArrayRef<mlir::Operation*>, mlir::ConversionTarget const&, mlir::FrozenRewritePatternSet const&, mlir::ConversionConfig, (anonymous namespace)::OpConversionMode)::$_0>(long) DialectConversion.cpp:0:0
#14 0x00007f76f8312f7d applyConversion(llvm::ArrayRef<mlir::Operation*>, mlir::ConversionTarget const&, mlir::FrozenRewritePatternSet const&, mlir::ConversionConfig, (anonymous namespace)::OpConversionMode) DialectConversion.cpp:0:0
#15 0x00007f76f83130fe mlir::applyFullConversion(mlir::Operation*, mlir::ConversionTarget const&, mlir::FrozenRewritePatternSet const&, mlir::ConversionConfig) (/opt/firtool-1.139.0/bin/../lib/libMLIRTransformUtils.so+0x310fe)
#16 0x00007f76f9fcc231 (anonymous namespace)::MooreToCorePass::runOnOperation() MooreToCore.cpp:0:0
#17 0x00007f76f80c82a5 mlir::detail::OpToOpPassAdaptor::run(mlir::Pass*, mlir::Operation*, mlir::AnalysisManager, bool, unsigned int) (/opt/firtool-1.139.0/bin/../lib/libMLIRPass.so+0x172a5)
#18 0x00007f76f80cb7a9 mlir::PassManager::run(mlir::Operation*) (/opt/firtool-1.139.0/bin/../lib/libMLIRPass.so+0x1a7a9)
#19 0x000055f92536d5d0 executeWithSources(mlir::MLIRContext*, llvm::SourceMgr&) circt-verilog.cpp:0:0
#20 0x000055f925368dd5 execute(mlir::MLIRContext*) circt-verilog.cpp:0:0
#21 0x000055f9253684b8 main (/opt/firtool/bin/circt-verilog+0x84b8)
#22 0x00007f76f58cb1ca __libc_start_call_main ./csu/../sysdeps/nptl/libc_start_call_main.h:74:3
#23 0x00007f76f58cb28b call_init ./csu/../csu/libc-start.c:128:20
#24 0x00007f76f58cb28b __libc_start_main ./csu/../csu/libc-start.c:347:5
#25 0x000055f925367b05 _start (/opt/firtool/bin/circt-verilog+0x7b05)

```

</details>

## Related Issues

- #8930: [MooreToCore] Crash with sqrt/floor (Same assertion, different root cause - real type vs union type)
- #7535: [MooreToCore] VariableOp lowered failed (Related type conversion pattern)
- #8471: [ImportVerilog] Union type in call

## Validation

- **Syntax Check**: Valid (verified with slang)
- **Cross-Tool Validation**:
  - Verilator: ✅ Pass
  - Icarus Verilog: ✅ Pass
  - Slang: ✅ Pass
- **Conclusion**: Valid SystemVerilog test case accepted by all other tools, unique crash in CIRCT

## Minimization Report

- **Original**: 14 lines
- **Minimized**: 3 lines
- **Reduction**: 78.6%

---
*This issue was generated with assistance from an automated bug reporter.*
