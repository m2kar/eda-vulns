<!--
  CIRCT Bug Report
  Generated by circt-bug-reporter skill
-->

<!-- Title: [Arc] Assertion failure when lowering inout ports - StateType does not support LLHD RefType -->

## Description

Arc StateType does not support LLHD RefType, causing an assertion failure when processing modules with `inout` ports through arcilator. The LowerState pass attempts to create `arc.state` storage for all module arguments, but fails when encountering `inout` ports which are represented as `!llhd.ref<T>` types in the LLHD dialect.

**Crash Type**: assertion
**Dialect**: arc, llhd
**Failing Pass**: LowerState

**Root Cause**: The `StateType::verify()` function checks that inner types have a known bit width via `computeLLVMBitWidth()`, but this function does not handle LLHD RefType, causing verification to fail with an assertion.

## Steps to Reproduce

1. Save test case below as `test.sv`
2. Run:
   ```bash
   circt-verilog --ir-hw test.sv | arcilator
   ```

## Test Case

```systemverilog
module Test(inout c);
endmodule
```

## Error Output

```
<unknown>:0: error: state type must have a known bit width; got '!llhd.ref<i1>'
arcilator: /home/zhiqing/edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/../mlir/include/mlir/IR/StorageUniquerSupport.h:180: static ConcreteT mlir::detail::StorageUserBase<circt::arc::StateType, mlir::Type, circt::arc::detail::StateTypeStorage, mlir::detail::TypeUniquer>::get(MLIRContext *, Args &&...) [ConcreteT = circt::arc::StateType, BaseT = mlir::Type, StorageT = circt::arc::detail::StateTypeStorage, UniquerT = mlir::detail::TypeUniquer, Traits = <>, Args = <mlir::Type &>]: Assertion `succeeded( ConcreteT::verifyInvariants(getDefaultDiagnosticEmitFn(ctx), args...))' failed.
PLEASE submit a bug report to https://github.com/llvm/llvm-project/issues/ and include the crash backtrace and instructions to reproduce the bug.
Stack dump:
0.	Program arguments: /edazz/FeatureFuzz-SV/target/circt-1.139.0/bin/arcilator
 #11 circt::arc::StateType::get(mlir::Type)
 #12 (anonymous namespace)::ModuleLowering::run() [LowerState.cpp:219]
 #13 (anonymous namespace)::LowerStatePass::runOnOperation() [LowerState.cpp:1198]
...
```

## Root Cause Analysis

The crash occurs in the Arc dialect's `LowerState` pass when processing modules with `inout` ports:

1. **Frontend (circt-verilog)**: Parses SystemVerilog modules with `inout` ports
2. **LLHD IR Generation**: `inout` ports are represented as `!llhd.ref<T>` (LLHD reference type)
3. **Arc LowerState Pass**: Attempts to create `arc.state` storage for all module arguments:
   ```cpp
   // LowerState.cpp:218-220
   for (auto arg : moduleOp.getBodyBlock()->getArguments()) {
     auto state = RootInputOp::create(..., StateType::get(arg.getType()), ...);
   }
   ```
4. **Type Verification Failure**:
   - `StateType::get()` calls `verifyInvariants()`
   - Verification requires inner type to have a known bit width via `computeLLVMBitWidth()`
   - `computeLLVMBitWidth()` does not handle `llhd::RefType`, returning `std::nullopt`
   - **Result**: Assertion failure

**Type System Incompatibility**: Arc StateType is designed for value types with known bit widths, but LLHD RefType is a reference/pointer type representing bidirectional signals. This semantic mismatch causes the crash.

## Environment

- **CIRCT Version**: 1.139.0
- **OS**: Linux
- **Architecture**: x86_64
- **Tool**: arcilator
- **Fuzzing Source**: FeatureFuzz-SV (Testcase ID: 260129-0000159c)

## Stack Trace

<details>
<summary>Click to expand stack trace</summary>

```
#11 circt::arc::StateType::get(mlir::Type) build/tools/circt/include/circt/Dialect/Arc/ArcTypes.cpp.inc:108:3
#12 (anonymous namespace)::ModuleLowering::run() lib/Dialect/Arc/Transforms/LowerState.cpp:219:66
#13 (anonymous namespace)::LowerStatePass::runOnOperation() lib/Dialect/Arc/Transforms/LowerState.cpp:1198:41
#15 mlir::detail::OpToOpPassAdaptor::run() mlir/lib/Pass/Pass.cpp:619:17
#22 processBuffer() tools/arcilator/arcilator.cpp:330:7
#23 processInputSplit() tools/arcilator/arcilator.cpp:546:12
#24 processInput() tools/arcilator/arcilator.cpp:562:12
#28 main tools/arcilator/arcilator.cpp:697:8
```

</details>

## Related Issues

### ⚠️ **DUPLICATE ISSUE**

This crash is a **confirmed duplicate** of:

- **#9574**: [Arc] Assertion failure when lowering inout ports in sequential logic
  - Status: OPEN
  - Similarity Score: 10.0/10.0 (Perfect Match)
  - Link: https://github.com/llvm/circt/issues/9574

**Matching Details**:
- ✅ Identical error message: `state type must have a known bit width; got '!llhd.ref<i1>'`
- ✅ Identical crash location: `StateType::get()` in `LowerState.cpp:219`
- ✅ Identical trigger: `inout` port processing
- ✅ Identical stack trace

### Other Related Issues

- #4036: [PrepareForEmission] Crash when inout operations are passed to instance ports
  - Different bug (hw/sv dialect, different crash location)

## Suggested Fixes

1. **Short-term**: Add early detection in LowerState pass to produce a user-friendly error:
   ```
   error: arcilator does not support inout ports (bidirectional I/O)
   ```

2. **Long-term**: Extend `computeLLVMBitWidth()` to handle `llhd::RefType` by extracting the nested type's width, or add proper support for inout ports in arcilator.

3. **Documentation**: Document that arcilator does not support inout ports until the issue is resolved.

## Validation

- ✅ Syntax validation passed (Verilator 5.022, Slang 10.0.6, circt-verilog)
- ✅ Crash reproducible with minimal test case
- ✅ Test case reduction: 89.8% (from 313 bytes to 32 bytes)
- ✅ Valid SystemVerilog code (inout is a standard language feature)

---
*This issue was generated with assistance from an automated bug reporter (FeatureFuzz-SV Testcase ID: 260129-0000159c)*

**Note**: This issue has been identified as a duplicate of #9574. If you encounter this crash, please reference and follow the existing issue instead of creating a new one.
