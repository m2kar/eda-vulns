<!--
  CIRCT Bug Report
  Generated by circt-bug-reporter skill
-->

<!-- Title: [Arc] Assertion failure in LowerState when processing inout ports with llhd.ref type -->

## Description

`arcilator` crashes with an assertion failure when processing SystemVerilog modules that contain `inout` ports. The crash occurs in the `LowerState` pass when attempting to create `arc::StateType` for module arguments that have type `!llhd.ref<i8>` (generated from inout ports during Moore → Core conversion).

The Arc dialect explicitly does not support `inout` ports (there's a verification check in `ModelOp::verify()`), but the crash occurs before that verification runs, resulting in a confusing assertion failure instead of a user-friendly error message.

**Crash Type**: assertion
**Dialect**: Arc (with LLHD types from Moore conversion)
**Failing Pass**: LowerStatePass

## Steps to Reproduce

1. Save test case below as `test.sv`
2. Run:
   ```bash
   /edazz/FeatureFuzz-SV/target/circt-1.139.0/bin/circt-verilog --ir-hw test.sv | /edazz/FeatureFuzz-SV/target/circt-1.139.0/bin/arcilator
   ```

## Test Case

```systemverilog
module M(inout logic c);
  assign c = 0;
endmodule
```

## Error Output

```
<unknown>:0: error: state type must have a known bit width; got '!llhd.ref<i8>'
arcilator: /edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/../mlir/include/mlir/IR/StorageUniquerSupport.h:180: static ConcreteT mlir::detail::StorageUserBase<circt::arc::StateType, mlir::Type, circt::arc::detail::StateTypeStorage, mlir::detail::TypeUniquer>::get(MLIRContext *, Args &&...) [ConcreteT = circt::arc::StateType, BaseT = mlir::Type, StorageT = circt::arc::detail::StateTypeStorage, UniquerT = mlir::detail::TypeUniquer, Traits = <>, Args = <mlir::Type &>]: Assertion `succeeded( ConcreteT::verifyInvariants(getDefaultDiagnosticEmitFn(ctx), args...))' failed.
PLEASE submit a bug report to https://github.com/llvm/llvm-project/issues/ and include the crash backtrace and instructions to reproduce the bug.
Stack dump:
0.	Program arguments: /edazz/FeatureFuzz-SV/target/circt-1.139.0/bin/arcilator
 #12 circt::arc::StateType::get(mlir::Type) /edazz/FeatureFuzz-SV/target/circt-1.139.0-src/build/tools/circt/include/circt/Dialect/Arc/ArcTypes.cpp.inc:108:3
 #13 (anonymous namespace)::ModuleLowering::run() /edazz/FeatureFuzz-SV/target/circt-1.139.0-src/lib/Dialect/Arc/Transforms/LowerState.cpp:219:66
...
Aborted (core dumped)
```

## Root Cause Analysis

### Hypothesis 1 (High Confidence)
**Cause**: `LowerState` pass lacks early check for `inout` ports (`!llhd.ref` type), causing `StateType::get()` to fail assertion when encountering unsupported type

**Evidence**:
1. Error message explicitly states `!llhd.ref<i8>` has no known bit width
2. `computeLLVMBitWidth()` in `ArcTypes.cpp` doesn't handle `llhd::RefType`, returns empty optional
3. `StateType::verify()` returns failure for unsupported types, but this triggers assertion inside `StateType::get()`
4. `ModelOp::verify()` has inout check (line 339) but executes too late in pipeline

**Mechanism**:
```
circt-verilog --ir-hw input.sv
  → Moore dialect (inout → RefType)
  → MooreToCore (RefType → !llhd.ref<i8>)

arcilator receives IR
  → Preprocessing passes (StripSV, etc.)
  → LowerStatePass::run()
    → ModuleLowering::run()
      → For each module argument:
          → StateType::get(arg.getType())  // arg.getType() = !llhd.ref<i8>
            → StateType::verify() → FAILS
              → ASSERTION FAILURE
```

## Environment

- **CIRCT Version**: 690366b6c (1.139.0)
- **LLVM Version**: 22.0.0git
- **Build Type**: Optimized build with assertions
- **OS**: Linux
- **Architecture**: x86_64

## Stack Trace

<details>
<summary>Click to expand stack trace</summary>

```
 #12 circt::arc::StateType::get(mlir::Type) /edazz/FeatureFuzz-SV/target/circt-1.139.0-src/build/tools/circt/include/circt/Dialect/Arc/ArcTypes.cpp.inc:108:3
 #13 (anonymous namespace)::ModuleLowering::run() /edazz/FeatureFuzz-SV/target/circt-1.139.0-src/lib/Dialect/Arc/Transforms/LowerState.cpp:219:66
 #14 (anonymous namespace)::LowerStatePass::runOnOperation() /edazz/FeatureFuzz-SV/target/circt-1.139.0-src/lib/Dialect/Arc/Transforms/LowerState.cpp:1198:9
 #15 mlir::detail::OpToOpPassAdaptor::run(mlir::Pass*, mlir::Operation*, mlir::AnalysisManager, bool, unsigned int)::$_3::operator()() const /edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/mlir/lib/Pass/Pass.cpp:613:24
 #16 void llvm::function_ref<void ()>::callback_fn<mlir::detail::OpToOpPassAdaptor::run(mlir::Pass*, mlir::Operation*, mlir::AnalysisManager, bool, unsigned int)::$_3>(long) /edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/include/llvm/ADT/STLFunctionalExtras.h:46:12
 #17 mlir::detail::OpToOpPassAdaptor::run(mlir::Pass*, mlir::Operation*, mlir::AnalysisManager, bool, unsigned int) /edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/mlir/lib/Pass/Pass.cpp:619:17
 #18 mlir::PassManager::runPasses(mlir::Operation*, mlir::AnalysisManager) /edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/mlir/lib/Pass/Pass.cpp:1123:3
 #19 mlir::PassManager::run(mlir::Operation*) /edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/mlir/lib/Pass/Pass.cpp:1097:0
```

</details>

## Suggested Fix

Add early validation in the `LowerState` pass to reject `inout` ports with a clear error message before attempting to create `StateType`:

```cpp
// In ModuleLowering::run(), before processing arguments (around line 215):
for (auto arg : moduleOp.getBodyBlock()->getArguments()) {
  if (isa<llhd::RefType>(arg.getType())) {
    return moduleOp.emitOpError()
        << "inout ports are not supported in arcilator; "
        << "argument " << arg.getArgNumber() << " has type " << arg.getType();
  }
}
```

## Related Issues

- #8825 - [LLHD] Switch from hw.inout to a custom signal reference type (discusses `!llhd.ref<T>` type design)

## Additional Notes

- The test case is syntactically valid SystemVerilog and compiles successfully with Verilator, Slang, and Icarus Verilog
- The `ModelOp::verify()` method already has a check for `inout` ports at line 339 of `ArcOps.cpp`, but this check runs after the `LowerState` pass
- This crash was discovered through fuzzing
- Issue report was NOT submitted to GitHub (as requested)

---
*This issue was generated with assistance from an automated bug reporter.*
