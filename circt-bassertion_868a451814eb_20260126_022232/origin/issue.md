<!-- 
  CIRCT Bug Report
  Generated by circt-bug-reporter skill
-->

<!-- Title: [Moore] Assertion failure in MooreToCore with string output port -->

## Description

The crash occurs when `circt-verilog` attempts to convert a Moore dialect module with a `string` type output port to the HW dialect. The `typeConverter.convertType()` in `getModulePortInfo()` returns a null Type for the string output port, and when `hw::ModulePortInfo` constructor calls `sanitizeInOut()`, the `dyn_cast<hw::InOutType>` on the null type triggers the LLVM assertion "dyn_cast on a non-existent value".

**Crash Type**: assertion  
**Dialect**: Moore  
**Failing Pass**: MooreToCore  

## Steps to Reproduce

1. Save the test case below as `test.sv`
2. Run:
   ```bash
   circt-verilog --ir-hw test.sv
   ```

## Test Case

```systemverilog
module e(output string o);endmodule
```

## Error Output

```
PLEASE submit a bug report to https://github.com/llvm/circt and include the crash backtrace.
Stack dump:
0.	Program arguments: circt-verilog --ir-hw bug.sv
 #0 0x00007f067a8a48a8 llvm::sys::PrintStackTrace(llvm::raw_ostream&, int)
 ...
 #4 0x00007f067eac68ae (anonymous namespace)::SVModuleOpConversion::matchAndRewrite(circt::moore::SVModuleOp, ...) MooreToCore.cpp:0:0
 ...
```

## Root Cause Analysis

### Hypothesis 1 (High Confidence)
**Cause**: Type conversion returns null for `string` type in output port context

**Evidence**:
- Test case uses `output string out` which is the sole output port
- Stack trace shows crash in `SVModuleOpConversion::matchAndRewrite`
- Assertion message indicates `dyn_cast` on non-existent (null) value
- `sim::DynamicStringType` may not be a valid HW port type

**Mechanism**: 
While `StringType` → `sim::DynamicStringType` conversion exists, the HW dialect's port system may not accept `DynamicStringType` as a valid port type. The code at `getModulePortInfo()` (line 243) doesn't check if `portTy` is null before using it. When the conversion fails (returns null), the null type propagates into `hw::PortInfo` and eventually crashes in `sanitizeInOut()` when calling `dyn_cast<hw::InOutType>` on the null type.

### Suggested Fix

Add null check in `getModulePortInfo()`:
```cpp
Type portTy = typeConverter.convertType(port.type);
if (!portTy) {
  // Emit proper error diagnostic for unconvertible type
  op.emitError() << "cannot convert port type " << port.type;
  return {}; // Or return failure
}
```

## Validation

| Check | Result |
|-------|--------|
| Syntax (slang 10.0.6) | ✅ Valid SystemVerilog |
| Verilator 5.022 | ✅ Lint passed |
| Icarus Verilog 13.0 | ⚠️ Unsupported (clear error message) |

The test case is valid SystemVerilog per IEEE 1800-2017. CIRCT should emit a proper error message instead of crashing.

## Environment

- **CIRCT Version**: firtool-1.139.0
- **OS**: Linux
- **Architecture**: x86_64

## Stack Trace

<details>
<summary>Click to expand full stack trace</summary>

```
PLEASE submit a bug report to https://github.com/llvm/circt and include the crash backtrace.
Stack dump:
0.	Program arguments: circt-verilog --ir-hw bug.sv
 #0 0x00007f067a8a48a8 llvm::sys::PrintStackTrace(llvm::raw_ostream&, int) (/opt/firtool-1.139.0/bin/../lib/libLLVMSupport.so+0x2008a8)
 #1 0x00007f067a8a22f5 llvm::sys::RunSignalHandlers() (/opt/firtool-1.139.0/bin/../lib/libLLVMSupport.so+0x1fe2f5)
 #2 0x00007f067a8a5631 SignalHandler(int, siginfo_t*, void*) Signals.cpp:0:0
 #3 0x00007f067a3b2330 (/lib/x86_64-linux-gnu/libc.so.6+0x45330)
 #4 0x00007f067eac68ae (anonymous namespace)::SVModuleOpConversion::matchAndRewrite(circt::moore::SVModuleOp, circt::moore::SVModuleOpAdaptor, mlir::ConversionPatternRewriter&) const MooreToCore.cpp:0:0
 #5 0x00007f067eac6b93 llvm::LogicalResult mlir::ConversionPattern::dispatchTo1To1<mlir::OpConversionPattern<circt::moore::SVModuleOp>, circt::moore::SVModuleOp>(mlir::OpConversionPattern<circt::moore::SVModuleOp> const&, circt::moore::SVModuleOp, circt::moore::SVModuleOp::GenericAdaptor<llvm::ArrayRef<mlir::ValueRange>>, mlir::ConversionPatternRewriter&) (/opt/firtool-1.139.0/bin/../lib/libCIRCTMooreToCore.so+0x50b93)
 #6 0x00007f067eac6530 mlir::OpConversionPattern<circt::moore::SVModuleOp>::matchAndRewrite(mlir::Operation*, llvm::ArrayRef<mlir::ValueRange>, mlir::ConversionPatternRewriter&) const (/opt/firtool-1.139.0/bin/../lib/libCIRCTMooreToCore.so+0x50530)
 #7 0x00007f067cdd8438 mlir::ConversionPattern::matchAndRewrite(mlir::Operation*, mlir::PatternRewriter&) const (/opt/firtool-1.139.0/bin/../lib/libMLIRTransformUtils.so+0x2a438)
 #8 0x00007f067cda28ed void llvm::function_ref<void ()>::callback_fn<mlir::PatternApplicator::matchAndRewrite(...)::$_0>(long) PatternApplicator.cpp:0:0
 #9 0x00007f067cd9f774 mlir::PatternApplicator::matchAndRewrite(...) (/opt/firtool-1.139.0/bin/../lib/libMLIRRewrite.so+0x7774)
#10 0x00007f067cdd9c6f (anonymous namespace)::OperationLegalizer::legalize(mlir::Operation*) DialectConversion.cpp:0:0
#11 0x00007f067cdd9470 mlir::OperationConverter::convert(mlir::Operation*, bool) (/opt/firtool-1.139.0/bin/../lib/libMLIRTransformUtils.so+0x2b470)
#12 0x00007f067cdd9dae mlir::OperationConverter::convertOperations(llvm::ArrayRef<mlir::Operation*>) (/opt/firtool-1.139.0/bin/../lib/libMLIRTransformUtils.so+0x2bdae)
#13 0x00007f067cde78e4 void llvm::function_ref<void ()>::callback_fn<applyConversion(...)::$_0>(long) DialectConversion.cpp:0:0
#14 0x00007f067cddef7d applyConversion(...) DialectConversion.cpp:0:0
#15 0x00007f067cddf0fe mlir::applyFullConversion(mlir::Operation*, mlir::ConversionTarget const&, mlir::FrozenRewritePatternSet const&, mlir::ConversionConfig) (/opt/firtool-1.139.0/bin/../lib/libMLIRTransformUtils.so+0x310fe)
#16 0x00007f067ea98231 (anonymous namespace)::MooreToCorePass::runOnOperation() MooreToCore.cpp:0:0
#17 0x00007f067cb942a5 mlir::detail::OpToOpPassAdaptor::run(mlir::Pass*, mlir::Operation*, mlir::AnalysisManager, bool, unsigned int) (/opt/firtool-1.139.0/bin/../lib/libMLIRPass.so+0x172a5)
#18 0x00007f067cb977a9 mlir::PassManager::run(mlir::Operation*) (/opt/firtool-1.139.0/bin/../lib/libMLIRPass.so+0x1a7a9)
#19 0x0000564844b4e5d0 executeWithSources(mlir::MLIRContext*, llvm::SourceMgr&) circt-verilog.cpp:0:0
#20 0x0000564844b49dd5 execute(mlir::MLIRContext*) circt-verilog.cpp:0:0
#21 0x0000564844b494b8 main (/opt/firtool-1.139.0/bin/circt-verilog+0x84b8)
#22 0x00007f067a3971ca __libc_start_call_main ./csu/../sysdeps/nptl/libc_start_call_main.h:74:3
#23 0x00007f067a39728b call_init ./csu/../csu/libc-start.c:128:20
#24 0x00007f067a39728b __libc_start_main ./csu/../csu/libc-start.c:347:5
#25 0x0000564844b48b05 _start (/opt/firtool-1.139.0/bin/circt-verilog+0x7b05)
```

</details>

## Related Issues

- [#8930](https://github.com/llvm/circt/issues/8930): [MooreToCore] Crash with sqrt/floor (Score: 12.5)
  - **Same assertion**: `dyn_cast on a non-existent value`
  - **Difference**: #8930 involves `real` type with `sqrt/floor`, this bug involves `string` type output port
  - **Relation**: Both appear to be different manifestations of the same underlying problem: MooreToCore type conversion returning null types that cause `dyn_cast` failures in `sanitizeInOut()`

---
*This issue was generated with assistance from an automated bug reporter.*
