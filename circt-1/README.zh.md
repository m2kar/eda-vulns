# CIRCT æ¼æ´æŠ¥å‘Š - æ•°ç»„ç´¢å¼•æ•æ„Ÿåˆ—è¡¨å¤„ç†ä¸ä¸€è‡´æ€§

**æ¼æ´ç¼–å·:** CVE-PENDING  
**CVSS è¯„åˆ†:** 5.3 (Medium)  
**å‘ç°æ—¥æœŸ:** 2026-01-18  
**å‘ç°è€…:** M2kar (@m2kar)  
**GitHub Issue:** https://github.com/llvm/circt/issues/9469  
**Fix PR:** https://github.com/llvm/circt/pull/9481

> [English Version / è‹±æ–‡ç‰ˆæœ¬](README.md)

---

## ç›®å½•

- [1. æ¼æ´æ¦‚è¿°](#1-æ¼æ´æ¦‚è¿°)
- [2. æŠ€æœ¯ç»†èŠ‚](#2-æŠ€æœ¯ç»†èŠ‚)
- [3. æ¼æ´å¤ç°](#3-æ¼æ´å¤ç°)
- [4. å½±å“åˆ†æ](#4-å½±å“åˆ†æ)
- [5. ä¿®å¤æ–¹æ¡ˆ](#5-ä¿®å¤æ–¹æ¡ˆ)
- [6. CVE åˆ†ç±»](#6-cve-åˆ†ç±»)
- [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)

---

## 1. æ¼æ´æ¦‚è¿°

### 1.1 æè¿°

CIRCT ç¼–è¯‘å™¨åœ¨å¤„ç† SystemVerilog æ•æ„Ÿåˆ—è¡¨ä¸­çš„ç›´æ¥æ•°ç»„ç´¢å¼•æ—¶å­˜åœ¨ä¸ä¸€è‡´æ€§ã€‚å½“ä½¿ç”¨ `clkin_data[0]` ä½œä¸ºæ—¶é’Ÿä¿¡å·æ—¶ï¼Œç¼–è¯‘å™¨æ— æ³•æ­£ç¡®å¤„ç†ï¼Œç”Ÿæˆéæ³•çš„ `llhd.constant_time` æ“ä½œå¯¼è‡´ç¼–è¯‘å¤±è´¥ã€‚ä½†ä½¿ç”¨è¯­ä¹‰ç­‰ä»·çš„ä¸­é—´çº¿ç½‘èµ‹å€¼æ–¹å¼å¯ä»¥æˆåŠŸç¼–è¯‘ã€‚

### 1.2 å½±å“èŒƒå›´

- **å½±å“ç‰ˆæœ¬:** CIRCT firtool-1.139.0 åŠæ›´æ—©ç‰ˆæœ¬
- **å½±å“ç»„ä»¶:** circt-verilog, arcilator, LLHD lowering pipeline
- **å½±å“åœºæ™¯:**
  - âŒ ç›´æ¥æ•°ç»„ç´¢å¼•ä½œä¸ºæ—¶é’Ÿ/å¤ä½ä¿¡å·
  - âŒ è‡ªåŠ¨åŒ–ç¡¬ä»¶ç”Ÿæˆå·¥å…·ï¼ˆå¦‚ Yosysï¼‰äº§ç”Ÿçš„ä»£ç 
  - âŒ å¤šæ—¶é’ŸåŸŸè®¾è®¡ä¸­çš„ç´¢å¼•æ—¶é’Ÿé€‰æ‹©
  - âœ… ä½¿ç”¨ä¸­é—´çº¿ç½‘çš„ç­‰ä»·ä»£ç å¯ä»¥å·¥ä½œ

---

## 2. æŠ€æœ¯ç»†èŠ‚

### 2.1 æ ¹æœ¬åŸå› 

LLHD lowering pipeline çš„ `Mem2Reg` å’Œ `HoistSignals` passes æ— æ³•è¯†åˆ«æ•°ç»„å…ƒç´ è®¿é—®ï¼ˆ`clkin_data[0]`ï¼‰ä½œä¸ºæœ‰æ•ˆçš„æ—¶é’Ÿä¿¡å·ï¼Œå¯¼è‡´ï¼š

1. Frontend æœªèƒ½æ­£ç¡®æ ‡è¯†ä¸ºæ—¶é’Ÿä¿¡å·
2. é™çº§è¿‡ç¨‹æ— æ³•è½¬æ¢ä¸º `seq.firreg` æ“ä½œ
3. ç”Ÿæˆéæ³•çš„ `llhd.constant_time` æ“ä½œ
4. Arcilator åç«¯æ‹’ç»ç¼–è¯‘

### 2.2 é”™è¯¯ç‰¹å¾

```
error: failed to legalize operation 'llhd.constant_time' that was explicitly marked illegal
    %0 = llhd.constant_time <0ns, 1d, 0e>
         ^
<stdin>:1:1: error: conversion to arcs failed
```

### 2.3 æ¼æ´ä»£ç ç¤ºä¾‹

**æ¼æ´ä»£ç  (top1.sv) - âŒ ç¼–è¯‘å¤±è´¥:**
```systemverilog
module top_arc(clkin_data, in_data, out_data);
  reg [5:0] _00_;
  input [63:0] clkin_data;
  input [191:0] in_data;
  output [191:0] out_data;

  // ç›´æ¥æ•°ç»„ç´¢å¼• - ç¼–è¯‘å¤±è´¥
  always_ff @(posedge clkin_data[0])
    if (!clkin_data[32]) _00_ <= 6'h00;
    else _00_ <= in_data[7:2];
endmodule
```

**å·¥ä½œåŒºä»£ç  (top2.sv) - âœ… ç¼–è¯‘æˆåŠŸ:**
```systemverilog
module top_arc(clkin_data, in_data, out_data);
  reg [5:0] _00_;
  input [63:0] clkin_data;
  input [191:0] in_data;
  output [191:0] out_data;

  // ä¸­é—´çº¿ç½‘èµ‹å€¼ - ç¼–è¯‘æˆåŠŸ
  wire clkin_0 = clkin_data[0];
  wire rst = clkin_data[32];
  
  always_ff @(posedge clkin_0)
    if (!rst) _00_ <= 6'h00;
    else _00_ <= in_data[7:2];
endmodule
```

---

## 3. æ¼æ´å¤ç°

### 3.1 é¡¹ç›®ç»“æ„

```
circt-1/
â”œâ”€â”€ Dockerfile                  # Docker æ¼æ´å¤ç°ç¯å¢ƒ
â”œâ”€â”€ test.sh                    # å¿«é€Ÿæµ‹è¯•è„šæœ¬
â”œâ”€â”€ reproduce.sh               # è‡ªåŠ¨åŒ–å¤ç°è„šæœ¬
â”œâ”€â”€ top1.sv                    # æ¼æ´è§¦å‘ä»£ç  (780B)
â”œâ”€â”€ top2.sv                    # å·¥ä½œåŒºä»£ç  (764B)
â””â”€â”€ results/                   # æµ‹è¯•è¾“å‡ºæ–‡ä»¶å¤¹
    â”œâ”€â”€ top1.err               # æ¼æ´ä»£ç é”™è¯¯è¾“å‡º
    â”œâ”€â”€ top1_detailed_ir.mlir  # æ¼æ´ä»£ç  IR åˆ†æ (66KB)
    â”œâ”€â”€ top2.json              # æˆåŠŸç¼–è¯‘çš„çŠ¶æ€æ–‡ä»¶ (471B)
    â”œâ”€â”€ top2_detailed_ir.mlir  # å·¥ä½œåŒºä»£ç  IR åˆ†æ (56KB)
    â””â”€â”€ top2.out               # æˆåŠŸç¼–è¯‘è¾“å‡º
```

### 3.2 å¿«é€Ÿå¤ç°

#### æ–¹å¼ 1: ä½¿ç”¨å¿«é€Ÿè„šæœ¬

```bash
# 1. æ„å»ºé•œåƒ (é¦–æ¬¡è¿è¡Œ)
./test.sh build

# 2. è¿è¡Œå®Œæ•´æµ‹è¯•
./test.sh run

# 3. ä¿å­˜è¾“å‡ºæ–‡ä»¶
./test.sh save

# 4. æŸ¥çœ‹å…¶ä»–é€‰é¡¹
./test.sh help
```

#### æ–¹å¼ 2: ä½¿ç”¨ Docker å‘½ä»¤

```bash
# ä» GitHub Container Registry æ‹‰å–é•œåƒ
docker pull ghcr.io/m2kar/eda-vulns/circt-1:latest

# è¿è¡Œæµ‹è¯•
docker run --platform linux/amd64 --rm ghcr.io/m2kar/eda-vulns/circt-1:latest

# ä¿å­˜è¾“å‡º
docker run --platform linux/amd64 --rm \
  -v $(pwd)/results:/vuln-reproduction/output \
  ghcr.io/m2kar/eda-vulns/circt-1:latest
```

#### æ–¹å¼ 3: æ‰‹åŠ¨æµ‹è¯•

```bash
# è¿›å…¥å®¹å™¨
docker run --platform linux/amd64 --rm -it \
  --entrypoint /bin/bash ghcr.io/m2kar/eda-vulns/circt-1:latest

# å®¹å™¨å†…æ‰‹åŠ¨è¿è¡Œ
circt-verilog --ir-hw top1.sv | arcilator --state-file=top1.json  # å¤±è´¥
circt-verilog --ir-hw top2.sv | arcilator --state-file=top2.json  # æˆåŠŸ
```

### 3.3 æµ‹è¯•ç»“æœ

**æµ‹è¯•å¹³å°:** macOS (Apple M3 Pro) + Docker (linux/amd64)  
**æµ‹è¯•æ—¥æœŸ:** 2026-01-21  
**CIRCT ç‰ˆæœ¬:** firtool-1.139.0

| æµ‹è¯•é¡¹ | é¢„æœŸ | å®é™… | çŠ¶æ€ |
|--------|------|------|------|
| æ¼æ´ä»£ç  (top1.sv) | ç¼–è¯‘å¤±è´¥ | ç¼–è¯‘å¤±è´¥ âŒ | âœ… PASS |
| å·¥ä½œåŒºä»£ç  (top2.sv) | ç¼–è¯‘æˆåŠŸ | ç¼–è¯‘æˆåŠŸ âœ… | âœ… PASS |
| é”™è¯¯ç‰¹å¾æ£€æµ‹ | llhd.constant_time | æ£€æµ‹åˆ° | âœ… PASS |

**ç»“è®º:** âœ… **æ¼æ´å¤ç°æˆåŠŸ**

---

## 4. å½±å“åˆ†æ

### 4.1 åŠŸèƒ½å½±å“

| ç±»åˆ« | å½±å“ç¨‹åº¦ | è¯´æ˜ |
|------|---------|------|
| è®¾è®¡æ­£ç¡®æ€§ | ğŸŸ¡ ä¸­ç­‰ | éœ€è¦ä»£ç é‡æ„ï¼Œä½†æœ‰ç®€å•å·¥ä½œåŒº |
| å·¥å…·äº’æ“ä½œæ€§ | ğŸŸ¡ ä¸­ç­‰ | å½±å“è‡ªåŠ¨åŒ–ç»¼åˆå·¥å…·å…¼å®¹æ€§ |
| å¼€å‘å·¥ä½œæµ | ğŸŸ¡ ä¸­ç­‰ | éœ€è¦äººå·¥å¹²é¢„ï¼Œä½†è§£å†³æ–¹æ¡ˆç›´æ¥ |
| éªŒè¯è¦†ç›– | ğŸŸ¢ ä½ | å·¥ä½œåŒºäº§ç”Ÿè¯­ä¹‰ç­‰ä»·è¡Œä¸º |

### 4.2 å®‰å…¨å½±å“

1. **ä»£ç å®Œæ•´æ€§é£é™©**
   - æ‰‹åŠ¨ä»£ç é‡æ„å¢åŠ äººä¸ºé”™è¯¯é£é™©
   - å¼ºåˆ¶ä¿®æ”¹å·²éªŒè¯è®¾è®¡å¯èƒ½å¼•å…¥åŠŸèƒ½ç¼ºé™·
   - åŸå§‹ä»£ç ä¸ä¿®æ”¹ä»£ç çš„å·®å¼‚ä½¿å®¡è®¡å¤æ‚åŒ–

2. **ä¾›åº”é“¾é£é™©**
   - è‡ªåŠ¨åŒ–ç¡¬ä»¶ç”Ÿæˆç®¡é“å¯èƒ½äº§ç”Ÿç¬¦åˆæ ‡å‡†ä½†ç¼–è¯‘å¤±è´¥çš„ä»£ç 
   - éœ€è¦äººå·¥å¹²é¢„ï¼Œç ´åè‡ªåŠ¨åŒ–å·¥ä½œæµ
   - å½±å“ç¡¬ä»¶æ„å»ºçš„å¯é‡å¤æ€§

3. **ç¼–è¯‘å™¨ä¿¡ä»»åº¦**
   - è¯­ä¹‰ç­‰ä»·ä»£ç çš„ä¸ä¸€è‡´å¤„ç†å‰Šå¼±ç¼–è¯‘å™¨å¯é æ€§
   - å¯èƒ½æ©ç›–æˆ–æŒ‡ç¤ºå…¶ä»–æœªå‘ç°çš„ç¼–è¯‘é—®é¢˜
   - é™ä½å¯¹ç¼–è¯‘å™¨æ­£ç¡®ç¿»è¯‘ HDL è§„èŒƒèƒ½åŠ›çš„ä¿¡å¿ƒ

### 4.3 å—å½±å“ç”¨ä¾‹

- **FPGA å¼€å‘:** æ—¶é’Ÿ/å¤ä½å¤šè·¯å¤ç”¨çš„ç›´æ¥æ•°ç»„ç´¢å¼•
- **ASIC è®¾è®¡:** å¤šæ—¶é’ŸåŸŸè®¾è®¡ä¸­çš„ç´¢å¼•æ—¶é’Ÿé€‰æ‹©
- **ç¡¬ä»¶æ¨¡ç³Šæµ‹è¯•:** è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆï¼ˆå¦‚ Yosysï¼‰
- **é—ç•™ IP è¿ç§»:** ä½¿ç”¨æ ‡å‡† SystemVerilog æ¨¡å¼çš„ç°æœ‰è®¾è®¡

---

## 5. ä¿®å¤æ–¹æ¡ˆ

### 5.1 ä¸´æ—¶å·¥ä½œåŒº

```systemverilog
// âŒ ä¼šå¤±è´¥çš„ä»£ç 
always_ff @(posedge clkin_data[0])
  if (!clkin_data[32]) begin
    // logic
  end

// âœ… å·¥ä½œåŒºä»£ç 
wire clk = clkin_data[0];
wire rst = clkin_data[32];
always_ff @(posedge clk)
  if (!rst) begin
    // logic
  end
```

### 5.2 é•¿æœŸè§£å†³æ–¹æ¡ˆ

å‡çº§åˆ°åŒ…å« PR #9481 ä¿®å¤çš„ CIRCT ç‰ˆæœ¬ï¼š

```bash
git clone https://github.com/llvm/circt.git
cd circt
git checkout main  # ç¡®ä¿åŒ…å« PR #9481
# æŒ‰ç…§å®˜æ–¹æ–‡æ¡£æ„å»º
```

### 5.3 æ£€æµ‹æ–¹æ³•

**Grep æ¨¡å¼æ£€æµ‹æ¼æ´ä»£ç :**
```bash
# æœç´¢æ•æ„Ÿåˆ—è¡¨ä¸­çš„æ•°ç»„ç´¢å¼•
grep -rn "@(posedge.*\[.*\]" *.sv
grep -rn "@(negedge.*\[.*\]" *.sv
```

**AST æ£€æµ‹:**
```bash
# ä½¿ç”¨ circt-verilog æ£€æŸ¥ä»£ç æ˜¯å¦è§¦å‘æ¼æ´
circt-verilog --ir-hw suspicious.sv 2>&1 | \
  grep -q "llhd.constant_time" && echo "VULNERABLE"
```

---

## 6. CVE åˆ†ç±»

### 6.1 CVSS v3.1 è¯„åˆ†

**å‘é‡å­—ç¬¦ä¸²:**  
`CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:L`

**åŸºç¡€åˆ†æ•°:** 5.3 (MEDIUM)

| æŒ‡æ ‡ | å€¼ | è¯´æ˜ |
|------|---|------|
| æ”»å‡»å‘é‡ (AV) | Local | éœ€è¦æœ¬åœ°è®¿é—®ç¼–è¯‘ç¯å¢ƒ |
| æ”»å‡»å¤æ‚åº¦ (AC) | Low | æ ‡å‡† SystemVerilog ä»£ç å³å¯è§¦å‘ |
| æ‰€éœ€æƒé™ (PR) | None | ä»»ä½•ç¼–è¯‘ç”¨æˆ·å‡å¯è§¦å‘ |
| ç”¨æˆ·äº¤äº’ (UI) | Required | ç”¨æˆ·å¿…é¡»å°è¯•ç¼–è¯‘ |
| èŒƒå›´ (S) | Unchanged | å½±å“é™äºç¼–è¯‘æµç¨‹ |
| æœºå¯†æ€§ (C) | None | æ— ä¿¡æ¯æ³„éœ² |
| å®Œæ•´æ€§ (I) | Low | éœ€è¦ä»£ç ä¿®æ”¹ä½†æœ‰å·¥ä½œåŒº |
| å¯ç”¨æ€§ (A) | Low | ä¸´æ—¶ä¸­æ–­ä½†è§£å†³æ–¹æ¡ˆç›´æ¥ |

### 6.2 CWE åˆ†ç±»

- **CWE-703:** Improper Check or Handling of Exceptional Conditions
- **CWE-697:** Incorrect Comparisonï¼ˆç¼–è¯‘å™¨æœªèƒ½è¯†åˆ«ç­‰ä»·ä¿¡å·è¡¨ç¤ºï¼‰
- **CWE-1304:** Improperly Preserved Integrity of Hardware Configuration State

### 6.3 é£é™©è¯„ä¼°

**é£é™©ç­‰çº§:** ğŸŸ¡ MEDIUM (CVSS 5.3)

**å»ºè®®ä¼˜å…ˆçº§:** MEDIUM - åº”åœ¨ä¸‹ä¸€ä¸ªç»´æŠ¤å‘¨æœŸéƒ¨ç½²ä¿®å¤

**ç†ç”±:**
- ç¼–è¯‘å™¨ä¸ä¸€è‡´æ€§å½±å“ä»£ç å®Œæ•´æ€§å’Œè‡ªåŠ¨åŒ–å·¥ä½œæµ
- éœ€è¦äººå·¥å¹²é¢„å¯èƒ½å¼•å…¥é”™è¯¯
- å½±å“é™äºå¼€å‘é˜¶æ®µï¼Œæœ‰æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯ï¼ˆéé™é»˜å¤±è´¥ï¼‰
- æœ‰æ–‡æ¡£å®Œå–„çš„å·¥ä½œåŒºï¼Œä½†å¢åŠ ç»´æŠ¤è´Ÿæ‹…
- æ— æœºå¯†æ€§æ³„éœ²æˆ–æƒé™æå‡

---

## 7. å‚è€ƒèµ„æ–™

### 7.1 GitHub èµ„æº

- **Issue:** https://github.com/llvm/circt/issues/9469
- **Fix PR:** https://github.com/llvm/circt/pull/9481
- **Related Issue:** https://github.com/llvm/circt/issues/9467

### 7.2 å®˜æ–¹æ–‡æ¡£

- **CIRCT:** https://circt.llvm.org/
- **LLHD Dialect:** https://circt.llvm.org/docs/Dialects/LLHD/
- **Arcilator:** https://circt.llvm.org/docs/Dialects/Arc/RationaleArc/

### 7.3 æ—¶é—´çº¿

| æ—¥æœŸ | äº‹ä»¶ |
|------|------|
| 2026-01-18 | M2kar å‘ç°å¹¶æŠ¥å‘Šæ¼æ´ (Issue #9469) |
| 2026-01-20 14:46 UTC | @5iri ç¡®è®¤ä¸ºæœ‰æ•ˆç¼ºé™· |
| 2026-01-20 15:05 UTC | @5iri è¯†åˆ«æ ¹æœ¬åŸå› åœ¨ WaitEventOpConversion |
| 2026-01-20 17:05 UTC | @fabianschuiki ç¡®è®¤åŒé‡é—®é¢˜ï¼šLLHD é™çº§å’Œ Arcilator æ”¯æŒ |
| 2026-01-20 17:30 UTC | @5iri è¢«åˆ†é…å®ç°ä¿®å¤ |
| 2026-01-21 | Pull Request #9481 æäº¤ |
| 2026-01-21 14:08 UTC | M2kar ç¡®è®¤ä¿®å¤è§£å†³é—®é¢˜ |

### 7.4 è´¡çŒ®è€…

- **å‘ç°è€…:** M2kar (@m2kar)
- **åˆ†æ:** 5iri (@5iri)
- **ç»´æŠ¤è€…:** Fabian Schuiki (@fabianschuiki)
- **ä¿®å¤å®ç°:** 5iri (@5iri)

---

## 8. é™„å½•

### 8.1 æµ‹è¯•ç¯å¢ƒ

- **æ“ä½œç³»ç»Ÿ:** Ubuntu 24.04 (x86_64) in Docker
- **å¹³å°:** macOS (Apple M3 Pro) with linux/amd64 emulation
- **CIRCT ç‰ˆæœ¬:** firtool-1.139.0
- **LLVM ç‰ˆæœ¬:** 22.0.0git

### 8.2 ç”Ÿæˆæ–‡ä»¶

```
results/
â”œâ”€â”€ top1.err                  342 bytes   æ¼æ´ä»£ç é”™è¯¯è¾“å‡º
â”œâ”€â”€ top1_detailed_ir.mlir     66 KB      æ¼æ´ä»£ç è¯¦ç»† IR
â”œâ”€â”€ top2.json                 471 bytes  âœ… æˆåŠŸçš„çŠ¶æ€æ–‡ä»¶
â”œâ”€â”€ top2_detailed_ir.mlir     56 KB      å·¥ä½œåŒºä»£ç è¯¦ç»† IR
â””â”€â”€ top2.out                  1.1 KB     æˆåŠŸç¼–è¯‘è¾“å‡º
```

### 8.3 æŠ«éœ²æ”¿ç­–

æœ¬æŠ¥å‘Šéµå¾ªåè°ƒæŠ«éœ²å®è·µï¼š

1. âœ… ä½¿ç”¨å…¬å¼€é—®é¢˜è·Ÿè¸ªå™¨ï¼ˆGitHub Issuesï¼‰- ä¾›åº”å•†é¦–é€‰æ¸ é“
2. âœ… ç»´æŠ¤è€…å‚ä¸ï¼Œä¿®å¤è¿›è¡Œä¸­ï¼ˆPR #9481ï¼‰
3. âœ… æœªè§‚å¯Ÿåˆ°ä¸»åŠ¨åˆ©ç”¨ï¼ˆç¼–è¯‘å™¨å·¥å…·é“¾ç¼ºé™·ï¼‰
4. âœ… å·¥ä½œåŒºå¯ç”¨ï¼ˆä¸­é—´çº¿ç½‘èµ‹å€¼ï¼‰
5. â³ ç­‰å¾… CVE åˆ†é…å’Œå®˜æ–¹ä¾›åº”å•†å…¬å‘Š

**çŠ¶æ€:** å…¬å¼€æŠ«éœ²ï¼Œä¿®å¤å¼€å‘ä¸­

---

## 9. è”ç³»æ–¹å¼

**å‘ç°è€…:** M2kar  
**GitHub:** [@m2kar](https://github.com/m2kar)  
**Email:** zhiqing.rui@gmail.com  
**Issue Tracker:** https://github.com/llvm/circt/issues/9469

---

**æ–‡æ¡£ç‰ˆæœ¬:** 2.0  
**æœ€åæ›´æ–°:** 2026-01-22  
**çŠ¶æ€:** å‡†å¤‡æäº¤ CVE  
**è®¸å¯è¯:** MIT
