<!-- 
  CIRCT Bug Report
  Generated by circt-bug-reporter skill
-->

<!-- Title: [Moore] Crash in MooreToCore when using string type port -->

## Description

`circt-verilog` crashes when processing a SystemVerilog module with a `string` type port. The crash occurs during the MooreToCore conversion pass because the type converter lacks a handler for `moore::StringType`.

The `string` type is valid IEEE 1800 SystemVerilog (verified by slang and verilator), but CIRCT crashes with an assertion failure instead of gracefully reporting that the feature is unsupported.

**Root Cause**: The `populateTypeConversion()` function in `MooreToCore.cpp` registers conversion handlers for various Moore types (IntType, RealType, ArrayType, StructType, etc.) but **does not include a handler for StringType**. When `typeConverter.convertType()` is called on a StringType port, it returns a null type, which then causes an assertion failure when constructing `hw::PortInfo`.

**Crash Type**: assertion
**Dialect**: Moore
**Failing Pass**: MooreToCore

## Steps to Reproduce

1. Save the test case below as `test.sv`
2. Run:
   ```bash
   circt-verilog --ir-hw test.sv
   ```

## Test Case

```systemverilog
module top(output string str_out);
endmodule
```

## Error Output

```
PLEASE submit a bug report to https://github.com/llvm/circt and include the crash backtrace.
Stack dump:
0.	Program arguments: /opt/firtool/bin/circt-verilog --ir-hw bug.sv
 #4 (anonymous namespace)::SVModuleOpConversion::matchAndRewrite(...) MooreToCore.cpp:0:0
 ...
#16 (anonymous namespace)::MooreToCorePass::runOnOperation() MooreToCore.cpp:0:0
```

## Root Cause Analysis

### Hypothesis (High Confidence)

**Cause**: MooreToCore type converter lacks `StringType` conversion handler

**Evidence**:
1. `populateTypeConversion()` in `MooreToCore.cpp` (lines 2220-2341) has no `StringType` handler
2. `FormatStringType` has a conversion (→ `sim::FormatStringType`), but regular `StringType` does not
3. Test case uses `output string str_out` which requires `StringType` conversion
4. Crash occurs in `SVModuleOpConversion` when building port info with null type

**Mechanism**: 
`typeConverter.convertType(StringType)` returns null (no matching converter). The code assumes conversion always succeeds and uses the null result to construct `hw::PortInfo`, triggering the assertion.

### Suggested Fix

Either:
1. Add a `StringType` conversion handler in `populateTypeConversion()`
2. Add null check after `convertType()` in `getModulePortInfo()` with clear error message
3. Reject `string` type ports earlier with a proper diagnostic

## Cross-Tool Validation

| Tool | Result |
|------|--------|
| Slang | ✅ Pass (valid SystemVerilog) |
| Verilator | ✅ Pass (valid SystemVerilog) |
| Icarus Verilog | ⚠️ "not supported" (graceful error) |
| **CIRCT** | ❌ **Crash** (assertion failure) |

The test case is syntactically valid SystemVerilog. Even if `string` type ports are not supported, CIRCT should emit a clear error message rather than crash.

## Environment

- **CIRCT Version**: firtool-1.139.0 (LLVM 22.0.0git)
- **OS**: Linux
- **Architecture**: x86_64

## Stack Trace

<details>
<summary>Click to expand stack trace</summary>

```
 #4 (anonymous namespace)::SVModuleOpConversion::matchAndRewrite(circt::moore::SVModuleOp, ...) MooreToCore.cpp
 #5 mlir::ConversionPattern::dispatchTo1To1<...>
 #6 mlir::OpConversionPattern<circt::moore::SVModuleOp>::matchAndRewrite(...)
 #7 mlir::ConversionPattern::matchAndRewrite(mlir::Operation*, mlir::PatternRewriter&)
#10 (anonymous namespace)::OperationLegalizer::legalize(mlir::Operation*)
#11 mlir::OperationConverter::convert(mlir::Operation*, bool)
#16 (anonymous namespace)::MooreToCorePass::runOnOperation() MooreToCore.cpp
#17 mlir::detail::OpToOpPassAdaptor::run(...)
#18 mlir::PassManager::run(mlir::Operation*)
```

</details>

## Related Issues

- #8332: [MooreToCore] Support for StringType from moore to llvm dialect (feature request for StringType support)
- #8382: [FIRRTL] Crash with fstring type on port (similar pattern in FIRRTL dialect)
- #8292: [MooreToCore] Support for Unsized Array Type (similar type conversion issue)

---
*This issue was generated with assistance from an automated bug reporter.*
