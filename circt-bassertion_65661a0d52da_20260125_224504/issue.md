<!--
  CIRCT Bug Report
  Generated by circt-bug-reporter skill
-->

<!-- Title: [Moore] Assertion failure in MooreToCore when lowering module with `string` type port -->

## Description

CIRCT's Moore dialect crashes when converting a SystemVerilog module that has a `string` type as an output port. The crash occurs during the MooreToCore lowering pass in the `getModulePortInfo()` function.

**Crash Type**: assertion
**Dialect**: Moore
**Failing Pass**: MooreToCore

The root cause is that `StringType` ports get converted to `sim::DynamicStringType` during type conversion, but when `hw::ModulePortInfo` constructor calls `sanitizeInOut()`, it performs a `dyn_cast<hw::InOutType>` on the port type. When the type conversion fails (returns null), the null type causes the `dyn_cast` assertion to fail with "dyn_cast on a non-existent value".

## Steps to Reproduce

1. Save the test case below as `test.sv`
2. Run:
   ```bash
   circt-verilog --ir-hw test.sv
   ```

## Test Case

```systemverilog
module Mod(output string str_out);
endmodule
```

## Error Output

```
circt-verilog: /edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/include/llvm/Support/Casting.h:650: decltype(auto) llvm::dyn_cast(From &) [To = circt::hw::InOutType, From = mlir::Type]: Assertion `detail::isPresent(Val) && "dyn_cast on a non-existent value"' failed.
PLEASE submit a bug report to https://github.com/llvm/circt and include the crash backtrace.
Stack dump:
...
 #17 circt::hw::ModulePortInfo::sanitizeInOut(...) /...PortImplementation.h:177:24
 #21 (anonymous namespace)::getModulePortInfo(mlir::TypeConverter const&, circt::moore::SVModuleOp) .../MooreToCore.cpp:259:1
...
Aborted (core dumped)
```

## Root Cause Analysis

### Hypothesis 1 (High Confidence)
**Cause**: `StringType` port type conversion results in a null/invalid `Type` object that triggers assertion failure

**Evidence**:
- Test case uses `string` type as module output port
- `StringType` gets converted to `sim::DynamicStringType` in MooreToCore type converter
- `getModulePortInfo()` calls `typeConverter.convertType(port.type)` without checking for null result
- Null type is passed to `hw::ModulePortInfo` constructor
- Constructor's `sanitizeInOut()` calls `dyn_cast<hw::InOutType>` on null type
- LLVM's `dyn_cast` has assertion `isPresent(Val)` which fails for null types

**Mechanism**:
The issue is in `lib/Conversion/MooreToCore/MooreToCore.cpp:259` in `getModulePortInfo()`:
```cpp
Type portTy = typeConverter.convertType(port.type);  // May return null
ports.push_back(hw::PortInfo{name, type, dir, loc, sym});  // Uses portTy
```

When `portTy` is null, creating `hw::PortInfo` and subsequently `hw::ModulePortInfo` causes the assertion in `sanitizeInOut()`.

## Environment

- **CIRCT Version**: circt-1.139.0
- **OS**: Linux (from fuzzer environment)
- **Architecture**: x86_64

## Validation Results

| Check | Result |
|-------|--------|
| Syntax Check | ✅ Valid (slang) |
| Verilator | ✅ Pass |
| Icarus Verilog | ⚠️  Limitation (Icarus doesn't support string type ports) |
| Slang | ✅ Pass |

**Classification**: `report` - Genuine bug with valid SystemVerilog test case

## Stack Trace

<details>
<summary>Click to expand stack trace</summary>

```
 #0 0x0000559f988a9ce7 llvm::sys::PrintStackTrace(llvm::raw_ostream&, int) /edazz/FeatureFuzz-SV/target/circt-1.139.0-src/llvm/llvm/lib/Support/Unix/Signals.inc:842:13
 #17 circt::hw::ModulePortInfo::sanitizeInOut() /...PortImplementation.h:177:24
 #21 (anonymous namespace)::getModulePortInfo(mlir::TypeConverter const&, circt::moore::SVModuleOp) /.../MooreToCore.cpp:259:1
 #35 (anonymous namespace)::MooreToCorePass::runOnOperation() /.../MooreToCore.cpp:2571:7
 #36 mlir::detail::OpToOpPassAdaptor::run(...) /.../Pass.cpp:613:24
 #42 mlir::PassManager::runPasses(...) /.../Pass.cpp:1123:3
 #43 mlir::PassManager::run(...) /.../Pass.cpp:1097:0
 #57 main /.../circt-verilog.cpp:528:8
Aborted (core dumped)
```

</details>

## Related Issues

- #8930: [MooreToCore] Crash with sqrt/floor (related - same `dyn_cast` assertion pattern in MooreToCore, but different unsupported type)
- #8176: [MooreToCore] Crash when getting values to observe
- #7627: [MooreToCore] Unpacked array causes crash (closed)

## Minimization Summary

- **Original**: 14 lines
- **Minimized**: 2 lines  
- **Reduction**: 85.7%

The minimal test case demonstrates that only a module declaration with a `string` output port is needed to trigger the crash.

## Suggested Fix Directions

1. Add null check after `typeConverter.convertType()` in `getModulePortInfo()`
2. Either reject `StringType` ports with a proper error message
3. Or add proper lowering support for `StringType` as HW module ports

---
*This issue was generated with assistance from an automated bug reporter.*
